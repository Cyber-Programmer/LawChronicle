{"ast":null,"code":"import _objectSpread from\"D:/DigiFloat/LawChronicle/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useMemo,useCallback}from'react';import{ChevronDown,ChevronRight,Calendar,MapPin,FileText,Tag,Download,Search,BarChart3,Shield,RefreshCw,AlertCircle,CheckCircle2}from'lucide-react';import AmendmentChainViewer,{AmendmentChainList}from'./AmendmentChainViewer';import{Phase5ApiService}from'./apiService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";// Safe group filtering and sorting with enhanced intelligent features\nconst filterAndSortGroups=(groups,filters,sortOptions)=>{if(!groups||groups.length===0)return[];let filtered=groups.filter(group=>{if(!group)return false;// Search term filter - enhanced to include constitutional analysis\nif(filters.searchTerm){var _group$provinces,_group$province,_group$statute_type,_group$constitutional,_group$constitutional2;const searchLower=filters.searchTerm.toLowerCase();const matchesTitle=(group.title||group.base_name||'').toLowerCase().includes(searchLower);const matchesProvince=((_group$provinces=group.provinces)===null||_group$provinces===void 0?void 0:_group$provinces.some(p=>p.toLowerCase().includes(searchLower)))||((_group$province=group.province)===null||_group$province===void 0?void 0:_group$province.toLowerCase().includes(searchLower))||false;const matchesType=((_group$statute_type=group.statute_type)===null||_group$statute_type===void 0?void 0:_group$statute_type.toLowerCase().includes(searchLower))||false;const matchesConstitutional=((_group$constitutional=group.constitutional_info)===null||_group$constitutional===void 0?void 0:(_group$constitutional2=_group$constitutional.constitutional_base)===null||_group$constitutional2===void 0?void 0:_group$constitutional2.toLowerCase().includes(searchLower))||false;if(!matchesTitle&&!matchesProvince&&!matchesType&&!matchesConstitutional)return false;}// Province filter\nif(filters.selectedProvince&&filters.selectedProvince!=='all'){var _group$provinces2;const hasProvince=((_group$provinces2=group.provinces)===null||_group$provinces2===void 0?void 0:_group$provinces2.includes(filters.selectedProvince))||group.province===filters.selectedProvince||false;if(!hasProvince)return false;}// Year filter\nif(filters.selectedYear&&filters.selectedYear!=='all'){var _group$years;const hasYear=((_group$years=group.years)===null||_group$years===void 0?void 0:_group$years.includes(filters.selectedYear))||false;if(!hasYear)return false;}// Constitutional filter\nif(filters.constitutionalOnly){var _group$constitutional3;const isConstitutional=((_group$constitutional3=group.constitutional_info)===null||_group$constitutional3===void 0?void 0:_group$constitutional3.is_constitutional)||false;if(!isConstitutional)return false;}// Amendment chain filter\nif(filters.showChainOnly){const hasChain=group.amendment_chain&&group.amendment_chain.members&&group.amendment_chain.members.length>1;if(!hasChain)return false;}// Amendment type filter\nif(filters.amendmentTypeFilter&&filters.amendmentTypeFilter!=='all'){var _group$constitutional4;const amendmentType=(_group$constitutional4=group.constitutional_info)===null||_group$constitutional4===void 0?void 0:_group$constitutional4.amendment_type;if(amendmentType!==filters.amendmentTypeFilter)return false;}return true;});// Enhanced sorting with intelligent analysis\nfiltered.sort((a,b)=>{var _a$years,_b$years,_a$provinces,_b$provinces,_a$amendment_chain,_b$amendment_chain,_a$constitutional_inf,_b$constitutional_inf;let aValue,bValue;switch(sortOptions.field){case'name':aValue=a.title||a.base_name||'';bValue=b.title||b.base_name||'';break;case'year':aValue=Math.max(...(((_a$years=a.years)===null||_a$years===void 0?void 0:_a$years.map(y=>parseInt(y)||0))||[0]));bValue=Math.max(...(((_b$years=b.years)===null||_b$years===void 0?void 0:_b$years.map(y=>parseInt(y)||0))||[0]));break;case'province':aValue=((_a$provinces=a.provinces)===null||_a$provinces===void 0?void 0:_a$provinces[0])||a.province||'';bValue=((_b$provinces=b.provinces)===null||_b$provinces===void 0?void 0:_b$provinces[0])||b.province||'';break;case'amendments':aValue=((_a$amendment_chain=a.amendment_chain)===null||_a$amendment_chain===void 0?void 0:_a$amendment_chain.total_amendments)||a.version_count||0;bValue=((_b$amendment_chain=b.amendment_chain)===null||_b$amendment_chain===void 0?void 0:_b$amendment_chain.total_amendments)||b.version_count||0;break;case'confidence':aValue=a.group_confidence||((_a$constitutional_inf=a.constitutional_info)===null||_a$constitutional_inf===void 0?void 0:_a$constitutional_inf.confidence)||0;bValue=b.group_confidence||((_b$constitutional_inf=b.constitutional_info)===null||_b$constitutional_inf===void 0?void 0:_b$constitutional_inf.confidence)||0;break;default:aValue=a.title||a.base_name||'';bValue=b.title||b.base_name||'';}if(typeof aValue==='string'){const comparison=aValue.localeCompare(bValue);return sortOptions.direction==='asc'?comparison:-comparison;}else{const comparison=aValue-bValue;return sortOptions.direction==='asc'?comparison:-comparison;}});return filtered;};// Statistics Panel Component\nconst StatisticsPanel=_ref=>{let{statistics,isLoading,error,onDetectChains,onExportJson,onExportCsv}=_ref;if(isLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"bg-white p-4 rounded-lg border border-gray-200 mb-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center py-4\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-5 h-5 animate-spin text-blue-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-gray-600\",children:\"Loading statistics...\"})]})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 p-4 rounded-lg border border-red-200 mb-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-red-800\",children:[/*#__PURE__*/_jsx(AlertCircle,{className:\"w-5 h-5 mr-2\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm\",children:[\"Failed to load statistics: \",error]})]})});}if(!statistics){return/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 p-4 rounded-lg border border-gray-200 mb-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center text-gray-500\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-8 h-8 mx-auto mb-2 text-gray-300\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:\"No statistics available\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded-lg border border-gray-200 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-5 h-5 mr-2 text-blue-600\"}),\"Collection Statistics\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[onDetectChains&&/*#__PURE__*/_jsxs(\"button\",{onClick:onDetectChains,className:\"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors\",children:[/*#__PURE__*/_jsx(FileText,{className:\"w-4 h-4 mr-1\"}),\"Detect Chains\"]}),onExportJson&&/*#__PURE__*/_jsxs(\"button\",{onClick:onExportJson,className:\"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors\",children:[/*#__PURE__*/_jsx(Download,{className:\"w-4 h-4 mr-1\"}),\"JSON\"]}),onExportCsv&&/*#__PURE__*/_jsxs(\"button\",{onClick:onExportCsv,className:\"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors\",children:[/*#__PURE__*/_jsx(Download,{className:\"w-4 h-4 mr-1\"}),\"CSV\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-blue-600\",children:statistics.total_statutes}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Total Statutes\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-green-600\",children:statistics.constitutional_amendments||0}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Constitutional\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-purple-600\",children:statistics.amendment_chains||0}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Amendment Chains\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-orange-600\",children:statistics.province_distribution.length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Provinces\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-medium text-gray-700 mb-2\",children:\"Top Provinces\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-1\",children:statistics.province_distribution.slice(0,3).map((item,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:item.province}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:item.count})]},index))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-medium text-gray-700 mb-2\",children:\"Statute Types\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-1\",children:statistics.type_distribution.slice(0,3).map((item,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:item.type}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:item.count})]},index))})]})]})]});};export default function GroupedStatutesViewer(_ref2){let{refreshTrigger,selectedCollection,onRefresh}=_ref2;const[groups,setGroups]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[expandedGroups,setExpandedGroups]=useState(new Set());const[loadingStatutes,setLoadingStatutes]=useState(new Set());const[availableProvinces,setAvailableProvinces]=useState([]);const[statistics,setStatistics]=useState(null);const[statsLoading,setStatsLoading]=useState(false);const[statsError,setStatsError]=useState(null);const[detectedChains,setDetectedChains]=useState([]);const[showChainList,setShowChainList]=useState(false);const[pagination,setPagination]=useState({page:1,limit:20,total:0,pages:0});const[filters,setFilters]=useState({searchTerm:'',selectedProvince:'all',selectedYear:'all',amendmentTypeFilter:'all',constitutionalOnly:false,showChainOnly:false});// Memoize filters to prevent unnecessary re-renders\nconst memoizedFilters=useMemo(()=>({searchTerm:filters.searchTerm,selectedProvince:filters.selectedProvince,selectedYear:filters.selectedYear,amendmentTypeFilter:filters.amendmentTypeFilter,constitutionalOnly:filters.constitutionalOnly,showChainOnly:filters.showChainOnly}),[filters.searchTerm,filters.selectedProvince,filters.selectedYear,filters.amendmentTypeFilter,filters.constitutionalOnly,filters.showChainOnly]);const[legacyFilters,setLegacyFilters]=useState({province:'',statute_type:'',base_name:''});const[sortOptions,setSortOptions]=useState({field:'name',direction:'asc'});// Memoized filtered and sorted groups\nconst filteredGroups=useMemo(()=>filterAndSortGroups(groups,memoizedFilters,sortOptions),[groups,memoizedFilters,sortOptions]);// Extract filter options from groups\nconst availableYears=useMemo(()=>{const years=new Set();groups.forEach(group=>{var _group$years2;(_group$years2=group.years)===null||_group$years2===void 0?void 0:_group$years2.forEach(y=>years.add(y));});return Array.from(years).sort((a,b)=>parseInt(b)-parseInt(a));},[groups]);const availableAmendmentTypes=useMemo(()=>{const types=new Set();groups.forEach(group=>{var _group$constitutional5;if((_group$constitutional5=group.constitutional_info)!==null&&_group$constitutional5!==void 0&&_group$constitutional5.amendment_type){types.add(group.constitutional_info.amendment_type);}});return Array.from(types).sort();},[groups]);// Enhanced API functions with retry mechanisms\nconst detectAmendmentChains=useCallback(async function(){let retries=arguments.length>0&&arguments[0]!==undefined?arguments[0]:3;if(!selectedCollection)return;for(let attempt=1;attempt<=retries;attempt++){try{const result=await Phase5ApiService.detectAmendmentChains(selectedCollection);setDetectedChains(result.chains||[]);setShowChainList(true);return;}catch(error){console.error(\"Amendment chain detection attempt \".concat(attempt,\" failed:\"),error);if(attempt===retries){setError(\"Failed to detect amendment chains after \".concat(retries,\" attempts\"));}else{// Wait before retry with exponential backoff\nawait new Promise(resolve=>setTimeout(resolve,1000*Math.pow(2,attempt-1)));}}}},[selectedCollection]);const exportGroups=useCallback(async function(format){let retries=arguments.length>1&&arguments[1]!==undefined?arguments[1]:3;if(!selectedCollection)return;for(let attempt=1;attempt<=retries;attempt++){try{const exportData=await Phase5ApiService.exportGroupsEnhanced(format,selectedCollection,true,// include analysis\nmemoizedFilters);await Phase5ApiService.downloadExport(exportData,\"phase5-groups-\".concat(selectedCollection,\"-\").concat(new Date().toISOString().split('T')[0]),format);return;}catch(error){console.error(\"Export attempt \".concat(attempt,\" failed:\"),error);if(attempt===retries){setError(\"Failed to export groups after \".concat(retries,\" attempts\"));}else{await new Promise(resolve=>setTimeout(resolve,1000*Math.pow(2,attempt-1)));}}}},[selectedCollection,memoizedFilters]);// Load provinces on mount\nuseEffect(()=>{const loadProvinces=async()=>{try{const response=await Phase5ApiService.getProvinces();setAvailableProvinces(response.provinces);}catch(error){console.error('Failed to load provinces:',error);// Don't show error for provinces - it's not critical\n}};loadProvinces();},[]);// Load statistics when collection changes\nuseEffect(()=>{const loadStatistics=async()=>{if(!selectedCollection)return;setStatsLoading(true);setStatsError(null);try{const stats=await Phase5ApiService.getCollectionStatistics(selectedCollection);setStatistics(stats);}catch(error){console.error('Failed to load statistics:',error);setStatsError(error instanceof Error?error.message:'Unknown error');}finally{setStatsLoading(false);}};if(selectedCollection){loadStatistics();}},[selectedCollection]);// Memoize legacyFilters to prevent unnecessary re-renders\nconst memoizedLegacyFilters=useMemo(()=>({province:legacyFilters.province,statute_type:legacyFilters.statute_type,base_name:legacyFilters.base_name}),[legacyFilters.province,legacyFilters.statute_type,legacyFilters.base_name]);// Load groups - memoized to prevent unnecessary re-renders\nconst loadGroups=useCallback(async function(){let page=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;try{setLoading(true);setError(null);// Use a fixed limit to prevent dependency cycles\nconst limit=20;const response=await Phase5ApiService.getGroups(page,limit,_objectSpread(_objectSpread(_objectSpread({},memoizedLegacyFilters.province&&{province:memoizedLegacyFilters.province}),memoizedLegacyFilters.statute_type&&{statute_type:memoizedLegacyFilters.statute_type}),memoizedLegacyFilters.base_name&&{base_name:memoizedLegacyFilters.base_name}));if(response.success){// Ensure groups is always an array\nconst groupsData=Array.isArray(response.groups)?response.groups:[];setGroups(groupsData);setPagination(response.pagination||{page:1,limit:20,total:0,pages:0});// Clear error if successful\nsetError(null);}else{setError(response.message||'Failed to load statute groups');setGroups([]);// Reset to empty array on error\n}}catch(err){console.error('Error loading groups:',err);setError(err instanceof Error?err.message:'Unknown error occurred');}finally{setLoading(false);}},[memoizedLegacyFilters]);// Load statutes for a specific group\nconst loadGroupStatutes=async groupId=>{try{setLoadingStatutes(prev=>new Set(prev).add(groupId));const response=await Phase5ApiService.getGroupedStatutes(groupId);if(response.success){setGroups(prevGroups=>prevGroups.map(group=>group.group_id===groupId?_objectSpread(_objectSpread({},group),{},{statutes:response.statutes}):group));}}catch(err){console.error('Error loading group statutes:',err);setError(err instanceof Error?err.message:'Failed to load group statutes');}finally{setLoadingStatutes(prev=>{const newSet=new Set(prev);newSet.delete(groupId);return newSet;});}};// Toggle group expansion\nconst toggleGroup=async groupId=>{const isExpanded=expandedGroups.has(groupId);const newExpanded=new Set(expandedGroups);if(isExpanded){newExpanded.delete(groupId);}else{newExpanded.add(groupId);// Load statutes if not already loaded\nconst group=groups.find(g=>g.group_id===groupId);if(group&&!group.statutes){await loadGroupStatutes(groupId);}}setExpandedGroups(newExpanded);};// Export groups\nconst handleExport=async format=>{try{const blob=await Phase5ApiService.exportGroups(format);const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=\"statute-groups.\".concat(format);document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);}catch(err){console.error('Export failed:',err);setError(err instanceof Error?err.message:'Export failed');}};// Load initial data\nuseEffect(()=>{loadGroups(1);},[loadGroups,refreshTrigger]);// Filter change handler\nconst handleFilterChange=(field,value)=>{setLegacyFilters(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:value}));setPagination(prev=>_objectSpread(_objectSpread({},prev),{},{page:1}));};if(loading&&(!groups||groups.length===0)){return/*#__PURE__*/_jsx(\"div\",{className:\"bg-white border border-gray-200 rounded-lg p-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-3 text-gray-600\",children:\"Loading statute groups...\"})]})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"bg-white border border-gray-200 rounded-lg p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(FileText,{className:\"h-12 w-12 text-gray-400 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"Error Loading Groups\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-4\",children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>loadGroups((pagination===null||pagination===void 0?void 0:pagination.page)||1),className:\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700\",children:\"Try Again\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[selectedCollection&&/*#__PURE__*/_jsx(StatisticsPanel,{statistics:statistics||undefined,isLoading:statsLoading,error:statsError||undefined,onDetectChains:detectAmendmentChains,onExportJson:()=>exportGroups('json'),onExportCsv:()=>exportGroups('csv')}),showChainList&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg border border-gray-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold\",children:\"Amendment Chains\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowChainList(false),className:\"text-gray-400 hover:text-gray-600\",children:\"\\xD7\"})]}),/*#__PURE__*/_jsx(AmendmentChainList,{chains:detectedChains,onChainSelect:chain=>console.log('Selected chain:',chain)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white border border-gray-200 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-6 border-b border-gray-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-xl font-semibold text-gray-900\",children:[\"Grouped Statutes\",(pagination===null||pagination===void 0?void 0:pagination.total)&&pagination.total>0&&/*#__PURE__*/_jsxs(\"span\",{className:\"ml-2 text-sm font-normal text-gray-500\",children:[\"(\",pagination.total.toLocaleString(),\" groups)\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleExport('json'),className:\"flex items-center px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(Download,{className:\"h-4 w-4 mr-1\"}),\"JSON\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleExport('csv'),className:\"flex items-center px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(Download,{className:\"h-4 w-4 mr-1\"}),\"CSV\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Search Groups\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(Search,{className:\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search by name, province, type, or constitutional base...\",value:filters.searchTerm,onChange:e=>setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{searchTerm:e.target.value})),className:\"pl-10 w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 md:grid-cols-4 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Province\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.selectedProvince,onChange:e=>setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{selectedProvince:e.target.value})),className:\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Provinces\"}),availableProvinces.map(province=>/*#__PURE__*/_jsx(\"option\",{value:province,children:province},province))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Year\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.selectedYear,onChange:e=>setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{selectedYear:e.target.value})),className:\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Years\"}),availableYears.map(year=>/*#__PURE__*/_jsx(\"option\",{value:year,children:year},year))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Amendment Type\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.amendmentTypeFilter,onChange:e=>setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{amendmentTypeFilter:e.target.value})),className:\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Types\"}),availableAmendmentTypes.map(type=>/*#__PURE__*/_jsx(\"option\",{value:type,children:type.charAt(0).toUpperCase()+type.slice(1)},type))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Sort By\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-1\",children:[/*#__PURE__*/_jsxs(\"select\",{value:sortOptions.field,onChange:e=>setSortOptions(prev=>_objectSpread(_objectSpread({},prev),{},{field:e.target.value})),className:\"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"name\",children:\"Name\"}),/*#__PURE__*/_jsx(\"option\",{value:\"year\",children:\"Year\"}),/*#__PURE__*/_jsx(\"option\",{value:\"province\",children:\"Province\"}),/*#__PURE__*/_jsx(\"option\",{value:\"amendments\",children:\"Amendments\"}),/*#__PURE__*/_jsx(\"option\",{value:\"confidence\",children:\"Confidence\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSortOptions(prev=>_objectSpread(_objectSpread({},prev),{},{direction:prev.direction==='asc'?'desc':'asc'})),className:\"px-3 py-2 border border-gray-300 rounded-md text-sm hover:bg-gray-50 transition-colors\",title:\"Sort \".concat(sortOptions.direction==='asc'?'ascending':'descending'),children:sortOptions.direction==='asc'?'↑':'↓'})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-6\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:filters.constitutionalOnly,onChange:e=>setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{constitutionalOnly:e.target.checked})),className:\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-sm text-gray-700\",children:\"Constitutional only\"})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:filters.showChainOnly,onChange:e=>setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{showChainOnly:e.target.checked})),className:\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-sm text-gray-700\",children:\"Amendment chains only\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setFilters({searchTerm:'',selectedProvince:'all',selectedYear:'all',amendmentTypeFilter:'all',constitutionalOnly:false,showChainOnly:false}),className:\"px-3 py-1 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50 transition-colors\",children:\"Clear all filters\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-3 gap-4 pt-4 border-t border-gray-200\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Legacy Search by Name\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(Search,{className:\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Enter statute name...\",value:legacyFilters.base_name,onChange:e=>handleFilterChange('base_name',e.target.value),className:\"pl-10 w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Legacy Province\"}),/*#__PURE__*/_jsxs(\"select\",{value:legacyFilters.province,onChange:e=>handleFilterChange('province',e.target.value),className:\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Provinces\"}),availableProvinces.map(province=>/*#__PURE__*/_jsx(\"option\",{value:province,children:province},province))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Legacy Statute Type\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"e.g., Act, Regulation...\",value:legacyFilters.statute_type,onChange:e=>handleFilterChange('statute_type',e.target.value),className:\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500\"})]})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-3 bg-gray-50 border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between text-sm text-gray-600\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Showing \",filteredGroups.length,\" of \",groups.length,\" groups\",filteredGroups.length!==groups.length&&/*#__PURE__*/_jsx(\"span\",{className:\"text-blue-600 ml-1\",children:\"(filtered)\"})]}),/*#__PURE__*/_jsxs(\"span\",{children:[filteredGroups.reduce((sum,group)=>{var _group$statutes;return sum+(group.total_statutes||group.version_count||((_group$statutes=group.statutes)===null||_group$statutes===void 0?void 0:_group$statutes.length)||0);},0),\" total statutes\"]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"divide-y divide-gray-200\",children:!groups||groups.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"p-8 text-center\",children:[/*#__PURE__*/_jsx(FileText,{className:\"h-12 w-12 text-gray-400 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:loading?'Loading Groups...':'No Grouped Statutes Available'}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:loading?'Please wait while we load the statute groups.':Object.values(legacyFilters).some(f=>f)?'Try adjusting your filters to see more results.':'Run the grouping process to create statute groups from your documents.'})]}):filteredGroups.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"p-8 text-center\",children:[/*#__PURE__*/_jsx(FileText,{className:\"h-12 w-12 text-gray-400 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"No Groups Match Your Filters\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-4\",children:\"Try adjusting your search terms or filter settings to find groups.\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setFilters({searchTerm:'',selectedProvince:'all',selectedYear:'all',amendmentTypeFilter:'all',constitutionalOnly:false,showChainOnly:false}),className:\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors\",children:\"Clear All Filters\"})]}):filteredGroups.map(group=>/*#__PURE__*/_jsx(GroupAccordion,{group:group,isExpanded:expandedGroups.has(group.group_id||group.id||''),isLoadingStatutes:loadingStatutes.has(group.group_id||group.id||''),onToggle:()=>toggleGroup(group.group_id||group.id||'')},group.group_id||group.id))}),(pagination===null||pagination===void 0?void 0:pagination.pages)&&pagination.pages>1&&/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border-t border-gray-200 flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-700\",children:[\"Showing page \",pagination.page||1,\" of \",pagination.pages||1]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>loadGroups((pagination.page||1)-1),disabled:(pagination.page||1)<=1||loading,className:\"px-3 py-2 text-sm border border-gray-300 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50\",children:\"Previous\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>loadGroups((pagination.page||1)+1),disabled:(pagination.page||1)>=(pagination.pages||1)||loading,className:\"px-3 py-2 text-sm border border-gray-300 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50\",children:\"Next\"})]})]})]})]});}function GroupAccordion(_ref3){var _group$constitutional6,_group$amendment_chai;let{group,isExpanded,isLoadingStatutes,onToggle}=_ref3;// Enhanced group properties from intelligent analysis\nconst hasAmendmentChain=group.amendment_chain&&group.amendment_chain.members&&group.amendment_chain.members.length>1;const isConstitutional=((_group$constitutional6=group.constitutional_info)===null||_group$constitutional6===void 0?void 0:_group$constitutional6.is_constitutional)||false;const hasIntelligentAnalysis=group.constitutional_info||group.amendment_chain;return/*#__PURE__*/_jsxs(\"div\",{className:\"border border-gray-200 rounded-lg overflow-hidden bg-white shadow-sm hover:shadow-md transition-shadow\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onToggle,className:\"w-full p-4 text-left bg-gray-50 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 transition-colors\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[isExpanded?/*#__PURE__*/_jsx(ChevronDown,{className:\"h-5 w-5 text-gray-400\"}):/*#__PURE__*/_jsx(ChevronRight,{className:\"h-5 w-5 text-gray-400\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-2\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mr-3\",children:group.base_name}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[isConstitutional&&/*#__PURE__*/_jsxs(\"div\",{className:\"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200\",children:[/*#__PURE__*/_jsx(Shield,{className:\"w-3 h-3 mr-1\"}),\"Constitutional\"]}),hasAmendmentChain&&/*#__PURE__*/_jsxs(\"div\",{className:\"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-purple-100 text-purple-800 border border-purple-200\",children:[/*#__PURE__*/_jsx(FileText,{className:\"w-3 h-3 mr-1\"}),(_group$amendment_chai=group.amendment_chain)===null||_group$amendment_chai===void 0?void 0:_group$amendment_chai.total_amendments,\" Amendments\"]}),hasIntelligentAnalysis&&/*#__PURE__*/_jsxs(\"div\",{className:\"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-green-100 text-green-800 border border-green-200\",children:[/*#__PURE__*/_jsx(CheckCircle2,{className:\"w-3 h-3 mr-1\"}),\"AI Analyzed\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4 text-sm text-gray-600\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(FileText,{className:\"h-4 w-4 mr-1\"}),group.version_count,\" version\",group.version_count!==1?'s':'']}),group.province&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"h-4 w-4 mr-1\"}),group.province]}),group.statute_type&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(Tag,{className:\"h-4 w-4 mr-1\"}),group.statute_type]}),group.group_confidence&&group.group_confidence>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(CheckCircle2,{className:\"w-4 h-4 mr-1\"}),Math.round(group.group_confidence*100),\"% confidence\"]})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:new Date(group.created_at).toLocaleDateString()})]})}),isExpanded&&/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border-t border-gray-200\",children:[isLoadingStatutes?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center py-4\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-5 h-5 animate-spin text-blue-500 mr-2\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Loading statutes...\"})]}):group.statutes&&group.statutes.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3 mb-4\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-medium text-gray-900\",children:[\"Statutes (\",group.statutes.length,\")\"]}),group.statutes.sort((a,b)=>a.version_number-b.version_number).map(statute=>/*#__PURE__*/_jsx(StatuteCard,{statute:statute},statute._id))]}):/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500 text-sm mb-4\",children:\"No statutes loaded for this group\"}),hasAmendmentChain&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-4\",children:/*#__PURE__*/_jsx(AmendmentChainViewer,{chain:group.amendment_chain,constitutionalAnalysis:group.constitutional_info,isExpanded:true,showFullDetails:false})}),group.constitutional_info&&!hasAmendmentChain&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-medium text-blue-900 mb-2\",children:\"Constitutional Analysis\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-blue-800\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Type:\"}),\" \",group.constitutional_info.amendment_type||'Not specified']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Base:\"}),\" \",group.constitutional_info.constitutional_base||'Not specified']}),group.constitutional_info.target_articles&&group.constitutional_info.target_articles.length>0&&/*#__PURE__*/_jsxs(\"p\",{className:\"mt-1\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Target Articles:\"}),\" \",group.constitutional_info.target_articles.slice(0,3).join(', '),group.constitutional_info.target_articles.length>3&&\" +\".concat(group.constitutional_info.target_articles.length-3,\" more\")]}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-1\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Confidence:\"}),\" \",Math.round((group.constitutional_info.confidence||0)*100),\"%\"]})]})]})]})]});}function StatuteCard(_ref4){var _statute$statute_data;let{statute}=_ref4;return/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-white border rounded-md \".concat(statute.is_base_version?'border-blue-200 bg-blue-50':'border-gray-200'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium \".concat(statute.is_base_version?'text-blue-900':'text-gray-900'),children:[\"Version \",statute.version_number,statute.is_base_version&&/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded-full\",children:\"Base\"})]}),statute.similarity_score&&/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs text-gray-500\",children:[\"(\",(statute.similarity_score*100).toFixed(1),\"% similarity)\"]})]}),statute.date_enacted&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-xs text-gray-600 mt-1\",children:[/*#__PURE__*/_jsx(Calendar,{className:\"h-3 w-3 mr-1\"}),new Date(statute.date_enacted).toLocaleDateString()]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:((_statute$statute_data=statute.statute_data)===null||_statute$statute_data===void 0?void 0:_statute$statute_data.title)||'No title'})]})});}","map":{"version":3,"names":["React","useState","useEffect","useMemo","useCallback","ChevronDown","ChevronRight","Calendar","MapPin","FileText","Tag","Download","Search","BarChart3","Shield","RefreshCw","AlertCircle","CheckCircle2","AmendmentChainViewer","AmendmentChainList","Phase5ApiService","jsx","_jsx","jsxs","_jsxs","filterAndSortGroups","groups","filters","sortOptions","length","filtered","filter","group","searchTerm","_group$provinces","_group$province","_group$statute_type","_group$constitutional","_group$constitutional2","searchLower","toLowerCase","matchesTitle","title","base_name","includes","matchesProvince","provinces","some","p","province","matchesType","statute_type","matchesConstitutional","constitutional_info","constitutional_base","selectedProvince","_group$provinces2","hasProvince","selectedYear","_group$years","hasYear","years","constitutionalOnly","_group$constitutional3","isConstitutional","is_constitutional","showChainOnly","hasChain","amendment_chain","members","amendmentTypeFilter","_group$constitutional4","amendmentType","amendment_type","sort","a","b","_a$years","_b$years","_a$provinces","_b$provinces","_a$amendment_chain","_b$amendment_chain","_a$constitutional_inf","_b$constitutional_inf","aValue","bValue","field","Math","max","map","y","parseInt","total_amendments","version_count","group_confidence","confidence","comparison","localeCompare","direction","StatisticsPanel","_ref","statistics","isLoading","error","onDetectChains","onExportJson","onExportCsv","className","children","onClick","total_statutes","constitutional_amendments","amendment_chains","province_distribution","slice","item","index","count","type_distribution","type","GroupedStatutesViewer","_ref2","refreshTrigger","selectedCollection","onRefresh","setGroups","loading","setLoading","setError","expandedGroups","setExpandedGroups","Set","loadingStatutes","setLoadingStatutes","availableProvinces","setAvailableProvinces","setStatistics","statsLoading","setStatsLoading","statsError","setStatsError","detectedChains","setDetectedChains","showChainList","setShowChainList","pagination","setPagination","page","limit","total","pages","setFilters","memoizedFilters","legacyFilters","setLegacyFilters","setSortOptions","filteredGroups","availableYears","forEach","_group$years2","add","Array","from","availableAmendmentTypes","types","_group$constitutional5","detectAmendmentChains","retries","arguments","undefined","attempt","result","chains","console","concat","Promise","resolve","setTimeout","pow","exportGroups","format","exportData","exportGroupsEnhanced","downloadExport","Date","toISOString","split","loadProvinces","response","getProvinces","loadStatistics","stats","getCollectionStatistics","Error","message","memoizedLegacyFilters","loadGroups","getGroups","_objectSpread","success","groupsData","isArray","err","loadGroupStatutes","groupId","prev","getGroupedStatutes","prevGroups","group_id","statutes","newSet","delete","toggleGroup","isExpanded","has","newExpanded","find","g","handleExport","blob","url","URL","createObjectURL","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","handleFilterChange","value","onChainSelect","chain","log","toLocaleString","placeholder","onChange","e","target","year","charAt","toUpperCase","checked","reduce","sum","_group$statutes","Object","values","f","GroupAccordion","id","isLoadingStatutes","onToggle","disabled","_ref3","_group$constitutional6","_group$amendment_chai","hasAmendmentChain","hasIntelligentAnalysis","round","created_at","toLocaleDateString","version_number","statute","StatuteCard","_id","constitutionalAnalysis","showFullDetails","target_articles","join","_ref4","_statute$statute_data","is_base_version","similarity_score","toFixed","date_enacted","statute_data"],"sources":["D:/DigiFloat/LawChronicle/frontend/src/components/phase5/GroupedStatutesViewer.tsx"],"sourcesContent":["import React, { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { \r\n  ChevronDown, \r\n  ChevronRight, \r\n  Calendar, \r\n  MapPin, \r\n  FileText, \r\n  Tag, \r\n  Download, \r\n  Search,\r\n  BarChart3,\r\n  Shield,\r\n  RefreshCw,\r\n  AlertCircle,\r\n  CheckCircle2\r\n} from 'lucide-react';\r\nimport AmendmentChainViewer, { AmendmentChainList } from './AmendmentChainViewer';\r\nimport { Phase5ApiService } from './apiService';\r\nimport type { \r\n  StatuteGroup, \r\n  GroupedStatute, \r\n  GroupsResponse, \r\n  GroupingFilters,\r\n  SortOptions,\r\n  AmendmentChain,\r\n  GroupingStatistics\r\n} from './types';\r\n\r\ninterface GroupedStatutesViewerProps {\r\n  refreshTrigger?: number;\r\n  selectedCollection?: string;\r\n  onRefresh?: () => void;\r\n}\r\n\r\n// Safe group filtering and sorting with enhanced intelligent features\r\nconst filterAndSortGroups = (\r\n  groups: StatuteGroup[], \r\n  filters: GroupingFilters, \r\n  sortOptions: SortOptions\r\n): StatuteGroup[] => {\r\n  if (!groups || groups.length === 0) return [];\r\n\r\n  let filtered = groups.filter(group => {\r\n    if (!group) return false;\r\n\r\n    // Search term filter - enhanced to include constitutional analysis\r\n    if (filters.searchTerm) {\r\n      const searchLower = filters.searchTerm.toLowerCase();\r\n      const matchesTitle = (group.title || group.base_name || '').toLowerCase().includes(searchLower);\r\n      const matchesProvince = group.provinces?.some(p => p.toLowerCase().includes(searchLower)) || \r\n                             group.province?.toLowerCase().includes(searchLower) || false;\r\n      const matchesType = group.statute_type?.toLowerCase().includes(searchLower) || false;\r\n      const matchesConstitutional = group.constitutional_info?.constitutional_base?.toLowerCase().includes(searchLower) || false;\r\n      \r\n      if (!matchesTitle && !matchesProvince && !matchesType && !matchesConstitutional) return false;\r\n    }\r\n\r\n    // Province filter\r\n    if (filters.selectedProvince && filters.selectedProvince !== 'all') {\r\n      const hasProvince = group.provinces?.includes(filters.selectedProvince) || \r\n                         group.province === filters.selectedProvince || false;\r\n      if (!hasProvince) return false;\r\n    }\r\n\r\n    // Year filter\r\n    if (filters.selectedYear && filters.selectedYear !== 'all') {\r\n      const hasYear = group.years?.includes(filters.selectedYear) || false;\r\n      if (!hasYear) return false;\r\n    }\r\n\r\n    // Constitutional filter\r\n    if (filters.constitutionalOnly) {\r\n      const isConstitutional = group.constitutional_info?.is_constitutional || false;\r\n      if (!isConstitutional) return false;\r\n    }\r\n\r\n    // Amendment chain filter\r\n    if (filters.showChainOnly) {\r\n      const hasChain = group.amendment_chain && group.amendment_chain.members && \r\n                      group.amendment_chain.members.length > 1;\r\n      if (!hasChain) return false;\r\n    }\r\n\r\n    // Amendment type filter\r\n    if (filters.amendmentTypeFilter && filters.amendmentTypeFilter !== 'all') {\r\n      const amendmentType = group.constitutional_info?.amendment_type;\r\n      if (amendmentType !== filters.amendmentTypeFilter) return false;\r\n    }\r\n\r\n    return true;\r\n  });\r\n\r\n  // Enhanced sorting with intelligent analysis\r\n  filtered.sort((a, b) => {\r\n    let aValue: any, bValue: any;\r\n\r\n    switch (sortOptions.field) {\r\n      case 'name':\r\n        aValue = a.title || a.base_name || '';\r\n        bValue = b.title || b.base_name || '';\r\n        break;\r\n      case 'year':\r\n        aValue = Math.max(...(a.years?.map(y => parseInt(y) || 0) || [0]));\r\n        bValue = Math.max(...(b.years?.map(y => parseInt(y) || 0) || [0]));\r\n        break;\r\n      case 'province':\r\n        aValue = a.provinces?.[0] || a.province || '';\r\n        bValue = b.provinces?.[0] || b.province || '';\r\n        break;\r\n      case 'amendments':\r\n        aValue = a.amendment_chain?.total_amendments || a.version_count || 0;\r\n        bValue = b.amendment_chain?.total_amendments || b.version_count || 0;\r\n        break;\r\n      case 'confidence':\r\n        aValue = a.group_confidence || a.constitutional_info?.confidence || 0;\r\n        bValue = b.group_confidence || b.constitutional_info?.confidence || 0;\r\n        break;\r\n      default:\r\n        aValue = a.title || a.base_name || '';\r\n        bValue = b.title || b.base_name || '';\r\n    }\r\n\r\n    if (typeof aValue === 'string') {\r\n      const comparison = aValue.localeCompare(bValue);\r\n      return sortOptions.direction === 'asc' ? comparison : -comparison;\r\n    } else {\r\n      const comparison = aValue - bValue;\r\n      return sortOptions.direction === 'asc' ? comparison : -comparison;\r\n    }\r\n  });\r\n\r\n  return filtered;\r\n};\r\n\r\n// Statistics Panel Component\r\nconst StatisticsPanel: React.FC<{ \r\n  statistics?: GroupingStatistics;\r\n  isLoading?: boolean;\r\n  error?: string;\r\n  onDetectChains?: () => void;\r\n  onExportJson?: () => void;\r\n  onExportCsv?: () => void;\r\n}> = ({ statistics, isLoading, error, onDetectChains, onExportJson, onExportCsv }) => {\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"bg-white p-4 rounded-lg border border-gray-200 mb-6\">\r\n        <div className=\"flex items-center justify-center py-4\">\r\n          <RefreshCw className=\"w-5 h-5 animate-spin text-blue-600\" />\r\n          <span className=\"ml-2 text-gray-600\">Loading statistics...</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"bg-red-50 p-4 rounded-lg border border-red-200 mb-6\">\r\n        <div className=\"flex items-center text-red-800\">\r\n          <AlertCircle className=\"w-5 h-5 mr-2\" />\r\n          <span className=\"text-sm\">Failed to load statistics: {error}</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!statistics) {\r\n    return (\r\n      <div className=\"bg-gray-50 p-4 rounded-lg border border-gray-200 mb-6\">\r\n        <div className=\"text-center text-gray-500\">\r\n          <BarChart3 className=\"w-8 h-8 mx-auto mb-2 text-gray-300\" />\r\n          <p className=\"text-sm\">No statistics available</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white p-4 rounded-lg border border-gray-200 mb-6\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h3 className=\"text-lg font-semibold flex items-center\">\r\n          <BarChart3 className=\"w-5 h-5 mr-2 text-blue-600\" />\r\n          Collection Statistics\r\n        </h3>\r\n        \r\n        <div className=\"flex items-center space-x-2\">\r\n          {onDetectChains && (\r\n            <button\r\n              onClick={onDetectChains}\r\n              className=\"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors\"\r\n            >\r\n              <FileText className=\"w-4 h-4 mr-1\" />\r\n              Detect Chains\r\n            </button>\r\n          )}\r\n          {onExportJson && (\r\n            <button\r\n              onClick={onExportJson}\r\n              className=\"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors\"\r\n            >\r\n              <Download className=\"w-4 h-4 mr-1\" />\r\n              JSON\r\n            </button>\r\n          )}\r\n          {onExportCsv && (\r\n            <button\r\n              onClick={onExportCsv}\r\n              className=\"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors\"\r\n            >\r\n              <Download className=\"w-4 h-4 mr-1\" />\r\n              CSV\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4\">\r\n        <div className=\"text-center\">\r\n          <div className=\"text-2xl font-bold text-blue-600\">{statistics.total_statutes}</div>\r\n          <div className=\"text-sm text-gray-600\">Total Statutes</div>\r\n        </div>\r\n        <div className=\"text-center\">\r\n          <div className=\"text-2xl font-bold text-green-600\">{statistics.constitutional_amendments || 0}</div>\r\n          <div className=\"text-sm text-gray-600\">Constitutional</div>\r\n        </div>\r\n        <div className=\"text-center\">\r\n          <div className=\"text-2xl font-bold text-purple-600\">{statistics.amendment_chains || 0}</div>\r\n          <div className=\"text-sm text-gray-600\">Amendment Chains</div>\r\n        </div>\r\n        <div className=\"text-center\">\r\n          <div className=\"text-2xl font-bold text-orange-600\">{statistics.province_distribution.length}</div>\r\n          <div className=\"text-sm text-gray-600\">Provinces</div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n        <div>\r\n          <h4 className=\"text-sm font-medium text-gray-700 mb-2\">Top Provinces</h4>\r\n          <div className=\"space-y-1\">\r\n            {statistics.province_distribution.slice(0, 3).map((item, index) => (\r\n              <div key={index} className=\"flex items-center justify-between text-sm\">\r\n                <span className=\"text-gray-600\">{item.province}</span>\r\n                <span className=\"font-medium\">{item.count}</span>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n        \r\n        <div>\r\n          <h4 className=\"text-sm font-medium text-gray-700 mb-2\">Statute Types</h4>\r\n          <div className=\"space-y-1\">\r\n            {statistics.type_distribution.slice(0, 3).map((item, index) => (\r\n              <div key={index} className=\"flex items-center justify-between text-sm\">\r\n                <span className=\"text-gray-600\">{item.type}</span>\r\n                <span className=\"font-medium\">{item.count}</span>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default function GroupedStatutesViewer({ \r\n  refreshTrigger, \r\n  selectedCollection,\r\n  onRefresh \r\n}: GroupedStatutesViewerProps) {\r\n  const [groups, setGroups] = useState<StatuteGroup[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [expandedGroups, setExpandedGroups] = useState<Set<string>>(new Set());\r\n  const [loadingStatutes, setLoadingStatutes] = useState<Set<string>>(new Set());\r\n  const [availableProvinces, setAvailableProvinces] = useState<string[]>([]);\r\n  const [statistics, setStatistics] = useState<GroupingStatistics | null>(null);\r\n  const [statsLoading, setStatsLoading] = useState(false);\r\n  const [statsError, setStatsError] = useState<string | null>(null);\r\n  const [detectedChains, setDetectedChains] = useState<AmendmentChain[]>([]);\r\n  const [showChainList, setShowChainList] = useState(false);\r\n  const [pagination, setPagination] = useState({\r\n    page: 1,\r\n    limit: 20,\r\n    total: 0,\r\n    pages: 0,\r\n  });\r\n  const [filters, setFilters] = useState<GroupingFilters>({\r\n    searchTerm: '',\r\n    selectedProvince: 'all',\r\n    selectedYear: 'all',\r\n    amendmentTypeFilter: 'all',\r\n    constitutionalOnly: false,\r\n    showChainOnly: false,\r\n  });\r\n  \r\n  // Memoize filters to prevent unnecessary re-renders\r\n  const memoizedFilters = useMemo(() => ({\r\n    searchTerm: filters.searchTerm,\r\n    selectedProvince: filters.selectedProvince,\r\n    selectedYear: filters.selectedYear,\r\n    amendmentTypeFilter: filters.amendmentTypeFilter,\r\n    constitutionalOnly: filters.constitutionalOnly,\r\n    showChainOnly: filters.showChainOnly\r\n  }), [\r\n    filters.searchTerm,\r\n    filters.selectedProvince,\r\n    filters.selectedYear,\r\n    filters.amendmentTypeFilter,\r\n    filters.constitutionalOnly,\r\n    filters.showChainOnly\r\n  ]);\r\n  const [legacyFilters, setLegacyFilters] = useState({\r\n    province: '',\r\n    statute_type: '',\r\n    base_name: '',\r\n  });\r\n  const [sortOptions, setSortOptions] = useState<SortOptions>({\r\n    field: 'name',\r\n    direction: 'asc'\r\n  });\r\n\r\n  // Memoized filtered and sorted groups\r\n  const filteredGroups = useMemo(\r\n    () => filterAndSortGroups(groups, memoizedFilters, sortOptions),\r\n    [groups, memoizedFilters, sortOptions]\r\n  );\r\n\r\n  // Extract filter options from groups\r\n  const availableYears = useMemo(() => {\r\n    const years = new Set<string>();\r\n    groups.forEach(group => {\r\n      group.years?.forEach(y => years.add(y));\r\n    });\r\n    return Array.from(years).sort((a, b) => parseInt(b) - parseInt(a));\r\n  }, [groups]);\r\n\r\n  const availableAmendmentTypes = useMemo(() => {\r\n    const types = new Set<string>();\r\n    groups.forEach(group => {\r\n      if (group.constitutional_info?.amendment_type) {\r\n        types.add(group.constitutional_info.amendment_type);\r\n      }\r\n    });\r\n    return Array.from(types).sort();\r\n  }, [groups]);\r\n\r\n  // Enhanced API functions with retry mechanisms\r\n  const detectAmendmentChains = useCallback(async (retries = 3) => {\r\n    if (!selectedCollection) return;\r\n    \r\n    for (let attempt = 1; attempt <= retries; attempt++) {\r\n      try {\r\n        const result = await Phase5ApiService.detectAmendmentChains(selectedCollection);\r\n        setDetectedChains(result.chains || []);\r\n        setShowChainList(true);\r\n        return;\r\n      } catch (error) {\r\n        console.error(`Amendment chain detection attempt ${attempt} failed:`, error);\r\n        if (attempt === retries) {\r\n          setError(`Failed to detect amendment chains after ${retries} attempts`);\r\n        } else {\r\n          // Wait before retry with exponential backoff\r\n          await new Promise(resolve => setTimeout(resolve, 1000 * Math.pow(2, attempt - 1)));\r\n        }\r\n      }\r\n    }\r\n  }, [selectedCollection]);\r\n\r\n  const exportGroups = useCallback(async (format: 'json' | 'csv', retries = 3) => {\r\n    if (!selectedCollection) return;\r\n    \r\n    for (let attempt = 1; attempt <= retries; attempt++) {\r\n      try {\r\n        const exportData = await Phase5ApiService.exportGroupsEnhanced(\r\n          format,\r\n          selectedCollection,\r\n          true, // include analysis\r\n          memoizedFilters\r\n        );\r\n        \r\n        await Phase5ApiService.downloadExport(\r\n          exportData,\r\n          `phase5-groups-${selectedCollection}-${new Date().toISOString().split('T')[0]}`,\r\n          format\r\n        );\r\n        return;\r\n      } catch (error) {\r\n        console.error(`Export attempt ${attempt} failed:`, error);\r\n        if (attempt === retries) {\r\n          setError(`Failed to export groups after ${retries} attempts`);\r\n        } else {\r\n          await new Promise(resolve => setTimeout(resolve, 1000 * Math.pow(2, attempt - 1)));\r\n        }\r\n      }\r\n    }\r\n  }, [selectedCollection, memoizedFilters]);\r\n\r\n  // Load provinces on mount\r\n  useEffect(() => {\r\n    const loadProvinces = async () => {\r\n      try {\r\n        const response = await Phase5ApiService.getProvinces();\r\n        setAvailableProvinces(response.provinces);\r\n      } catch (error) {\r\n        console.error('Failed to load provinces:', error);\r\n        // Don't show error for provinces - it's not critical\r\n      }\r\n    };\r\n\r\n    loadProvinces();\r\n  }, []);\r\n\r\n  // Load statistics when collection changes\r\n  useEffect(() => {\r\n    const loadStatistics = async () => {\r\n      if (!selectedCollection) return;\r\n      \r\n      setStatsLoading(true);\r\n      setStatsError(null);\r\n      try {\r\n        const stats = await Phase5ApiService.getCollectionStatistics(selectedCollection);\r\n        setStatistics(stats);\r\n      } catch (error) {\r\n        console.error('Failed to load statistics:', error);\r\n        setStatsError(error instanceof Error ? error.message : 'Unknown error');\r\n      } finally {\r\n        setStatsLoading(false);\r\n      }\r\n    };\r\n\r\n    if (selectedCollection) {\r\n      loadStatistics();\r\n    }\r\n  }, [selectedCollection]);\r\n\r\n  // Memoize legacyFilters to prevent unnecessary re-renders\r\n  const memoizedLegacyFilters = useMemo(() => ({\r\n    province: legacyFilters.province,\r\n    statute_type: legacyFilters.statute_type,\r\n    base_name: legacyFilters.base_name\r\n  }), [\r\n    legacyFilters.province,\r\n    legacyFilters.statute_type,\r\n    legacyFilters.base_name\r\n  ]);\r\n\r\n  // Load groups - memoized to prevent unnecessary re-renders\r\n  const loadGroups = useCallback(async (page: number = 1) => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      // Use a fixed limit to prevent dependency cycles\r\n      const limit = 20;\r\n      \r\n      const response: GroupsResponse = await Phase5ApiService.getGroups(\r\n        page, \r\n        limit,\r\n        {\r\n          ...(memoizedLegacyFilters.province && { province: memoizedLegacyFilters.province }),\r\n          ...(memoizedLegacyFilters.statute_type && { statute_type: memoizedLegacyFilters.statute_type }),\r\n          ...(memoizedLegacyFilters.base_name && { base_name: memoizedLegacyFilters.base_name }),\r\n        }\r\n      );\r\n      \r\n      if (response.success) {\r\n        // Ensure groups is always an array\r\n        const groupsData = Array.isArray(response.groups) ? response.groups : [];\r\n        setGroups(groupsData);\r\n        \r\n        setPagination(response.pagination || {\r\n          page: 1,\r\n          limit: 20,\r\n          total: 0,\r\n          pages: 0,\r\n        });\r\n        \r\n        // Clear error if successful\r\n        setError(null);\r\n      } else {\r\n        setError(response.message || 'Failed to load statute groups');\r\n        setGroups([]); // Reset to empty array on error\r\n      }\r\n    } catch (err) {\r\n      console.error('Error loading groups:', err);\r\n      setError(err instanceof Error ? err.message : 'Unknown error occurred');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [memoizedLegacyFilters]);\r\n\r\n  // Load statutes for a specific group\r\n  const loadGroupStatutes = async (groupId: string) => {\r\n    try {\r\n      setLoadingStatutes(prev => new Set(prev).add(groupId));\r\n      \r\n      const response = await Phase5ApiService.getGroupedStatutes(groupId);\r\n      \r\n      if (response.success) {\r\n        setGroups(prevGroups => \r\n          prevGroups.map(group => \r\n            group.group_id === groupId \r\n              ? { ...group, statutes: response.statutes }\r\n              : group\r\n          )\r\n        );\r\n      }\r\n    } catch (err) {\r\n      console.error('Error loading group statutes:', err);\r\n      setError(err instanceof Error ? err.message : 'Failed to load group statutes');\r\n    } finally {\r\n      setLoadingStatutes(prev => {\r\n        const newSet = new Set(prev);\r\n        newSet.delete(groupId);\r\n        return newSet;\r\n      });\r\n    }\r\n  };\r\n\r\n  // Toggle group expansion\r\n  const toggleGroup = async (groupId: string) => {\r\n    const isExpanded = expandedGroups.has(groupId);\r\n    const newExpanded = new Set(expandedGroups);\r\n    \r\n    if (isExpanded) {\r\n      newExpanded.delete(groupId);\r\n    } else {\r\n      newExpanded.add(groupId);\r\n      \r\n      // Load statutes if not already loaded\r\n      const group = groups.find(g => g.group_id === groupId);\r\n      if (group && !group.statutes) {\r\n        await loadGroupStatutes(groupId);\r\n      }\r\n    }\r\n    \r\n    setExpandedGroups(newExpanded);\r\n  };\r\n\r\n  // Export groups\r\n  const handleExport = async (format: 'json' | 'csv') => {\r\n    try {\r\n      const blob = await Phase5ApiService.exportGroups(format);\r\n      const url = URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      a.download = `statute-groups.${format}`;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      document.body.removeChild(a);\r\n      URL.revokeObjectURL(url);\r\n    } catch (err) {\r\n      console.error('Export failed:', err);\r\n      setError(err instanceof Error ? err.message : 'Export failed');\r\n    }\r\n  };\r\n\r\n  // Load initial data\r\n  useEffect(() => {\r\n    loadGroups(1);\r\n  }, [loadGroups, refreshTrigger]);\r\n\r\n  // Filter change handler\r\n  const handleFilterChange = (field: keyof typeof legacyFilters, value: string) => {\r\n    setLegacyFilters(prev => ({\r\n      ...prev,\r\n      [field]: value,\r\n    }));\r\n    setPagination(prev => ({ ...prev, page: 1 }));\r\n  };\r\n\r\n  if (loading && (!groups || groups.length === 0)) {\r\n    return (\r\n      <div className=\"bg-white border border-gray-200 rounded-lg p-8\">\r\n        <div className=\"flex items-center justify-center\">\r\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\"></div>\r\n          <span className=\"ml-3 text-gray-600\">Loading statute groups...</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"bg-white border border-gray-200 rounded-lg p-6\">\r\n        <div className=\"text-center\">\r\n          <FileText className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Error Loading Groups</h3>\r\n          <p className=\"text-gray-600 mb-4\">{error}</p>\r\n          <button\r\n            onClick={() => loadGroups(pagination?.page || 1)}\r\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700\"\r\n          >\r\n            Try Again\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Statistics panel */}\r\n      {selectedCollection && (\r\n        <StatisticsPanel \r\n          statistics={statistics || undefined} \r\n          isLoading={statsLoading} \r\n          error={statsError || undefined}\r\n          onDetectChains={detectAmendmentChains}\r\n          onExportJson={() => exportGroups('json')}\r\n          onExportCsv={() => exportGroups('csv')}\r\n        />\r\n      )}\r\n\r\n      {/* Amendment chains modal */}\r\n      {showChainList && (\r\n        <div className=\"bg-white p-6 rounded-lg border border-gray-200\">\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <h3 className=\"text-lg font-semibold\">Amendment Chains</h3>\r\n            <button\r\n              onClick={() => setShowChainList(false)}\r\n              className=\"text-gray-400 hover:text-gray-600\"\r\n            >\r\n              ×\r\n            </button>\r\n          </div>\r\n          <AmendmentChainList \r\n            chains={detectedChains}\r\n            onChainSelect={(chain) => console.log('Selected chain:', chain)}\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"bg-white border border-gray-200 rounded-lg\">\r\n      {/* Header */}\r\n      <div className=\"p-6 border-b border-gray-200\">\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h2 className=\"text-xl font-semibold text-gray-900\">\r\n            Grouped Statutes\r\n            {pagination?.total && pagination.total > 0 && (\r\n              <span className=\"ml-2 text-sm font-normal text-gray-500\">\r\n                ({pagination.total.toLocaleString()} groups)\r\n              </span>\r\n            )}\r\n          </h2>\r\n          <div className=\"flex items-center space-x-2\">\r\n            <button\r\n              onClick={() => handleExport('json')}\r\n              className=\"flex items-center px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50\"\r\n            >\r\n              <Download className=\"h-4 w-4 mr-1\" />\r\n              JSON\r\n            </button>\r\n            <button\r\n              onClick={() => handleExport('csv')}\r\n              className=\"flex items-center px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50\"\r\n            >\r\n              <Download className=\"h-4 w-4 mr-1\" />\r\n              CSV\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Enhanced Search and Filter Controls */}\r\n        <div className=\"space-y-4\">\r\n          {/* Search Bar */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n              Search Groups\r\n            </label>\r\n            <div className=\"relative\">\r\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Search by name, province, type, or constitutional base...\"\r\n                value={filters.searchTerm}\r\n                onChange={(e) => setFilters(prev => ({ ...prev, searchTerm: e.target.value }))}\r\n                className=\"pl-10 w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Filter Grid */}\r\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                Province\r\n              </label>\r\n              <select\r\n                value={filters.selectedProvince}\r\n                onChange={(e) => setFilters(prev => ({ ...prev, selectedProvince: e.target.value }))}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500\"\r\n              >\r\n                <option value=\"all\">All Provinces</option>\r\n                {availableProvinces.map((province) => (\r\n                  <option key={province} value={province}>\r\n                    {province}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                Year\r\n              </label>\r\n              <select\r\n                value={filters.selectedYear}\r\n                onChange={(e) => setFilters(prev => ({ ...prev, selectedYear: e.target.value }))}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500\"\r\n              >\r\n                <option value=\"all\">All Years</option>\r\n                {availableYears.map((year) => (\r\n                  <option key={year} value={year}>\r\n                    {year}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                Amendment Type\r\n              </label>\r\n              <select\r\n                value={filters.amendmentTypeFilter}\r\n                onChange={(e) => setFilters(prev => ({ ...prev, amendmentTypeFilter: e.target.value }))}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500\"\r\n              >\r\n                <option value=\"all\">All Types</option>\r\n                {availableAmendmentTypes.map((type) => (\r\n                  <option key={type} value={type}>\r\n                    {type.charAt(0).toUpperCase() + type.slice(1)}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                Sort By\r\n              </label>\r\n              <div className=\"flex space-x-1\">\r\n                <select\r\n                  value={sortOptions.field}\r\n                  onChange={(e) => setSortOptions(prev => ({ ...prev, field: e.target.value as any }))}\r\n                  className=\"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500\"\r\n                >\r\n                  <option value=\"name\">Name</option>\r\n                  <option value=\"year\">Year</option>\r\n                  <option value=\"province\">Province</option>\r\n                  <option value=\"amendments\">Amendments</option>\r\n                  <option value=\"confidence\">Confidence</option>\r\n                </select>\r\n                <button\r\n                  onClick={() => setSortOptions(prev => ({ \r\n                    ...prev, \r\n                    direction: prev.direction === 'asc' ? 'desc' : 'asc' \r\n                  }))}\r\n                  className=\"px-3 py-2 border border-gray-300 rounded-md text-sm hover:bg-gray-50 transition-colors\"\r\n                  title={`Sort ${sortOptions.direction === 'asc' ? 'ascending' : 'descending'}`}\r\n                >\r\n                  {sortOptions.direction === 'asc' ? '↑' : '↓'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Filter Checkboxes */}\r\n          <div className=\"flex items-center space-x-6\">\r\n            <label className=\"flex items-center\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={filters.constitutionalOnly}\r\n                onChange={(e) => setFilters(prev => ({ ...prev, constitutionalOnly: e.target.checked }))}\r\n                className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\r\n              />\r\n              <span className=\"ml-2 text-sm text-gray-700\">Constitutional only</span>\r\n            </label>\r\n\r\n            <label className=\"flex items-center\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={filters.showChainOnly}\r\n                onChange={(e) => setFilters(prev => ({ ...prev, showChainOnly: e.target.checked }))}\r\n                className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\r\n              />\r\n              <span className=\"ml-2 text-sm text-gray-700\">Amendment chains only</span>\r\n            </label>\r\n\r\n            <button\r\n              onClick={() => setFilters({\r\n                searchTerm: '',\r\n                selectedProvince: 'all',\r\n                selectedYear: 'all',\r\n                amendmentTypeFilter: 'all',\r\n                constitutionalOnly: false,\r\n                showChainOnly: false,\r\n              })}\r\n              className=\"px-3 py-1 text-sm text-blue-600 hover:text-blue-800 border border-blue-300 rounded hover:bg-blue-50 transition-colors\"\r\n            >\r\n              Clear all filters\r\n            </button>\r\n          </div>\r\n\r\n          {/* Legacy Filters for Backward Compatibility */}\r\n          <div className=\"grid grid-cols-3 gap-4 pt-4 border-t border-gray-200\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                Legacy Search by Name\r\n              </label>\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Enter statute name...\"\r\n                  value={legacyFilters.base_name}\r\n                  onChange={(e) => handleFilterChange('base_name', e.target.value)}\r\n                  className=\"pl-10 w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500\"\r\n                />\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                Legacy Province\r\n              </label>\r\n              <select\r\n                value={legacyFilters.province}\r\n                onChange={(e) => handleFilterChange('province', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500\"\r\n              >\r\n                <option value=\"\">All Provinces</option>\r\n                {availableProvinces.map((province) => (\r\n                  <option key={province} value={province}>\r\n                    {province}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                Legacy Statute Type\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"e.g., Act, Regulation...\"\r\n                value={legacyFilters.statute_type}\r\n                onChange={(e) => handleFilterChange('statute_type', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Results Summary */}\r\n      <div className=\"px-6 py-3 bg-gray-50 border-b border-gray-200\">\r\n        <div className=\"flex items-center justify-between text-sm text-gray-600\">\r\n          <span>\r\n            Showing {filteredGroups.length} of {groups.length} groups\r\n            {filteredGroups.length !== groups.length && (\r\n              <span className=\"text-blue-600 ml-1\">(filtered)</span>\r\n            )}\r\n          </span>\r\n          <span>\r\n            {filteredGroups.reduce((sum, group) => sum + (group.total_statutes || group.version_count || group.statutes?.length || 0), 0)} total statutes\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Groups List */}\r\n      <div className=\"divide-y divide-gray-200\">\r\n        {!groups || groups.length === 0 ? (\r\n          <div className=\"p-8 text-center\">\r\n            <FileText className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\r\n              {loading ? 'Loading Groups...' : 'No Grouped Statutes Available'}\r\n            </h3>\r\n            <p className=\"text-gray-600\">\r\n              {loading \r\n                ? 'Please wait while we load the statute groups.'\r\n                : Object.values(legacyFilters).some(f => f) \r\n                  ? 'Try adjusting your filters to see more results.' \r\n                  : 'Run the grouping process to create statute groups from your documents.'}\r\n            </p>\r\n          </div>\r\n        ) : filteredGroups.length === 0 ? (\r\n          <div className=\"p-8 text-center\">\r\n            <FileText className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No Groups Match Your Filters</h3>\r\n            <p className=\"text-gray-600 mb-4\">\r\n              Try adjusting your search terms or filter settings to find groups.\r\n            </p>\r\n            <button\r\n              onClick={() => setFilters({\r\n                searchTerm: '',\r\n                selectedProvince: 'all',\r\n                selectedYear: 'all',\r\n                amendmentTypeFilter: 'all',\r\n                constitutionalOnly: false,\r\n                showChainOnly: false,\r\n              })}\r\n              className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors\"\r\n            >\r\n              Clear All Filters\r\n            </button>\r\n          </div>\r\n        ) : (\r\n          filteredGroups.map((group) => (\r\n            <GroupAccordion\r\n              key={group.group_id || group.id}\r\n              group={group}\r\n              isExpanded={expandedGroups.has(group.group_id || group.id || '')}\r\n              isLoadingStatutes={loadingStatutes.has(group.group_id || group.id || '')}\r\n              onToggle={() => toggleGroup(group.group_id || group.id || '')}\r\n            />\r\n          ))\r\n        )}\r\n      </div>\r\n\r\n      {/* Pagination */}\r\n      {pagination?.pages && pagination.pages > 1 && (\r\n        <div className=\"p-4 border-t border-gray-200 flex items-center justify-between\">\r\n          <div className=\"text-sm text-gray-700\">\r\n            Showing page {pagination.page || 1} of {pagination.pages || 1}\r\n          </div>\r\n          <div className=\"flex space-x-2\">\r\n            <button\r\n              onClick={() => loadGroups((pagination.page || 1) - 1)}\r\n              disabled={(pagination.page || 1) <= 1 || loading}\r\n              className=\"px-3 py-2 text-sm border border-gray-300 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50\"\r\n            >\r\n              Previous\r\n            </button>\r\n            <button\r\n              onClick={() => loadGroups((pagination.page || 1) + 1)}\r\n              disabled={(pagination.page || 1) >= (pagination.pages || 1) || loading}\r\n              className=\"px-3 py-2 text-sm border border-gray-300 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50\"\r\n            >\r\n              Next\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface GroupAccordionProps {\r\n  group: StatuteGroup;\r\n  isExpanded: boolean;\r\n  isLoadingStatutes: boolean;\r\n  onToggle: () => void;\r\n}\r\n\r\nfunction GroupAccordion({ group, isExpanded, isLoadingStatutes, onToggle }: GroupAccordionProps) {\r\n  // Enhanced group properties from intelligent analysis\r\n  const hasAmendmentChain = group.amendment_chain && group.amendment_chain.members && group.amendment_chain.members.length > 1;\r\n  const isConstitutional = group.constitutional_info?.is_constitutional || false;\r\n  const hasIntelligentAnalysis = group.constitutional_info || group.amendment_chain;\r\n\r\n  return (\r\n    <div className=\"border border-gray-200 rounded-lg overflow-hidden bg-white shadow-sm hover:shadow-md transition-shadow\">\r\n      {/* Enhanced Group Header */}\r\n      <button\r\n        onClick={onToggle}\r\n        className=\"w-full p-4 text-left bg-gray-50 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 transition-colors\"\r\n      >\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center space-x-3\">\r\n            {isExpanded ? (\r\n              <ChevronDown className=\"h-5 w-5 text-gray-400\" />\r\n            ) : (\r\n              <ChevronRight className=\"h-5 w-5 text-gray-400\" />\r\n            )}\r\n            <div className=\"flex-1\">\r\n              <div className=\"flex items-center mb-2\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900 mr-3\">{group.base_name}</h3>\r\n                \r\n                {/* Enhanced Badges */}\r\n                <div className=\"flex items-center space-x-2\">\r\n                  {isConstitutional && (\r\n                    <div className=\"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200\">\r\n                      <Shield className=\"w-3 h-3 mr-1\" />\r\n                      Constitutional\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {hasAmendmentChain && (\r\n                    <div className=\"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-purple-100 text-purple-800 border border-purple-200\">\r\n                      <FileText className=\"w-3 h-3 mr-1\" />\r\n                      {group.amendment_chain?.total_amendments} Amendments\r\n                    </div>\r\n                  )}\r\n\r\n                  {hasIntelligentAnalysis && (\r\n                    <div className=\"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-green-100 text-green-800 border border-green-200\">\r\n                      <CheckCircle2 className=\"w-3 h-3 mr-1\" />\r\n                      AI Analyzed\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Enhanced Group metadata */}\r\n              <div className=\"flex items-center space-x-4 text-sm text-gray-600\">\r\n                <div className=\"flex items-center\">\r\n                  <FileText className=\"h-4 w-4 mr-1\" />\r\n                  {group.version_count} version{group.version_count !== 1 ? 's' : ''}\r\n                </div>\r\n                \r\n                {group.province && (\r\n                  <div className=\"flex items-center\">\r\n                    <MapPin className=\"h-4 w-4 mr-1\" />\r\n                    {group.province}\r\n                  </div>\r\n                )}\r\n                \r\n                {group.statute_type && (\r\n                  <div className=\"flex items-center\">\r\n                    <Tag className=\"h-4 w-4 mr-1\" />\r\n                    {group.statute_type}\r\n                  </div>\r\n                )}\r\n\r\n                {group.group_confidence && group.group_confidence > 0 && (\r\n                  <div className=\"flex items-center\">\r\n                    <CheckCircle2 className=\"w-4 h-4 mr-1\" />\r\n                    {Math.round(group.group_confidence * 100)}% confidence\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"text-xs text-gray-500\">\r\n            {new Date(group.created_at).toLocaleDateString()}\r\n          </div>\r\n        </div>\r\n      </button>\r\n\r\n      {/* Enhanced Group Details */}\r\n      {isExpanded && (\r\n        <div className=\"p-4 border-t border-gray-200\">\r\n          {isLoadingStatutes ? (\r\n            <div className=\"flex items-center justify-center py-4\">\r\n              <RefreshCw className=\"w-5 h-5 animate-spin text-blue-500 mr-2\" />\r\n              <span className=\"text-gray-600\">Loading statutes...</span>\r\n            </div>\r\n          ) : group.statutes && group.statutes.length > 0 ? (\r\n            <div className=\"space-y-3 mb-4\">\r\n              <h4 className=\"font-medium text-gray-900\">Statutes ({group.statutes.length})</h4>\r\n              {group.statutes\r\n                .sort((a, b) => a.version_number - b.version_number)\r\n                .map((statute) => (\r\n                  <StatuteCard key={statute._id} statute={statute} />\r\n                ))}\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-gray-500 text-sm mb-4\">No statutes loaded for this group</div>\r\n          )}\r\n\r\n          {/* Amendment chain visualization */}\r\n          {hasAmendmentChain && (\r\n            <div className=\"mt-4\">\r\n              <AmendmentChainViewer\r\n                chain={group.amendment_chain}\r\n                constitutionalAnalysis={group.constitutional_info}\r\n                isExpanded={true}\r\n                showFullDetails={false}\r\n              />\r\n            </div>\r\n          )}\r\n\r\n          {/* Constitutional analysis display */}\r\n          {group.constitutional_info && !hasAmendmentChain && (\r\n            <div className=\"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md\">\r\n              <h5 className=\"font-medium text-blue-900 mb-2\">Constitutional Analysis</h5>\r\n              <div className=\"text-sm text-blue-800\">\r\n                <p><strong>Type:</strong> {group.constitutional_info.amendment_type || 'Not specified'}</p>\r\n                <p><strong>Base:</strong> {group.constitutional_info.constitutional_base || 'Not specified'}</p>\r\n                {group.constitutional_info.target_articles && group.constitutional_info.target_articles.length > 0 && (\r\n                  <p className=\"mt-1\">\r\n                    <strong>Target Articles:</strong> {group.constitutional_info.target_articles.slice(0, 3).join(', ')}\r\n                    {group.constitutional_info.target_articles.length > 3 && ` +${group.constitutional_info.target_articles.length - 3} more`}\r\n                  </p>\r\n                )}\r\n                <p className=\"mt-1\">\r\n                  <strong>Confidence:</strong> {Math.round((group.constitutional_info.confidence || 0) * 100)}%\r\n                </p>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface StatuteCardProps {\r\n  statute: GroupedStatute;\r\n}\r\n\r\nfunction StatuteCard({ statute }: StatuteCardProps) {\r\n  return (\r\n    <div className={`p-3 bg-white border rounded-md ${statute.is_base_version ? 'border-blue-200 bg-blue-50' : 'border-gray-200'}`}>\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex-1\">\r\n          <div className=\"flex items-center space-x-2\">\r\n            <span className={`text-sm font-medium ${statute.is_base_version ? 'text-blue-900' : 'text-gray-900'}`}>\r\n              Version {statute.version_number}\r\n              {statute.is_base_version && (\r\n                <span className=\"ml-2 px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded-full\">\r\n                  Base\r\n                </span>\r\n              )}\r\n            </span>\r\n            {statute.similarity_score && (\r\n              <span className=\"text-xs text-gray-500\">\r\n                ({(statute.similarity_score * 100).toFixed(1)}% similarity)\r\n              </span>\r\n            )}\r\n          </div>\r\n          {statute.date_enacted && (\r\n            <div className=\"flex items-center text-xs text-gray-600 mt-1\">\r\n              <Calendar className=\"h-3 w-3 mr-1\" />\r\n              {new Date(statute.date_enacted).toLocaleDateString()}\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div className=\"text-xs text-gray-500\">\r\n          {statute.statute_data?.title || 'No title'}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}