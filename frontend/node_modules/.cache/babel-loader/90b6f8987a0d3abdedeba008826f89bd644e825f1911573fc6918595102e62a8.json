{"ast":null,"code":"import _objectSpread from\"D:/DigiFloat/LawChronicle/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState,useEffect,useCallback}from'react';import{authService}from'../services/authService';export const useAuth=()=>{const[authState,setAuthState]=useState({isAuthenticated:false,user:null,token:localStorage.getItem('token'),isLoading:true});const login=useCallback(async(username,password)=>{try{const response=await authService.login(username,password);const{access_token}=response.data;localStorage.setItem('token',access_token);// Get user info\nconst userResponse=await authService.getCurrentUser();const user=userResponse.data;setAuthState({isAuthenticated:true,user,token:access_token,isLoading:false});return{success:true};}catch(error){return{success:false,error:error instanceof Error?error.message:'Login failed'};}},[]);const logout=useCallback(()=>{localStorage.removeItem('token');setAuthState({isAuthenticated:false,user:null,token:null,isLoading:false});},[]);const checkAuth=useCallback(async()=>{const token=localStorage.getItem('token');if(!token){setAuthState(prev=>_objectSpread(_objectSpread({},prev),{},{isLoading:false}));return;}try{const response=await authService.getCurrentUser();const user=response.data;setAuthState({isAuthenticated:true,user,token,isLoading:false});}catch(error){// Token is invalid, remove it\nlocalStorage.removeItem('token');setAuthState({isAuthenticated:false,user:null,token:null,isLoading:false});}},[]);useEffect(()=>{checkAuth();},[]);// Remove checkAuth dependency to prevent loops\nreturn _objectSpread(_objectSpread({},authState),{},{login,logout,checkAuth});};","map":{"version":3,"names":["useState","useEffect","useCallback","authService","useAuth","authState","setAuthState","isAuthenticated","user","token","localStorage","getItem","isLoading","login","username","password","response","access_token","data","setItem","userResponse","getCurrentUser","success","error","Error","message","logout","removeItem","checkAuth","prev","_objectSpread"],"sources":["D:/DigiFloat/LawChronicle/frontend/src/hooks/useAuth.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport { authService } from '../services/authService';\r\n\r\ninterface User {\r\n  user_id: string;\r\n  username: string;\r\n}\r\n\r\ninterface AuthState {\r\n  isAuthenticated: boolean;\r\n  user: User | null;\r\n  token: string | null;\r\n  isLoading: boolean;\r\n}\r\n\r\nexport const useAuth = () => {\r\n  const [authState, setAuthState] = useState<AuthState>({\r\n    isAuthenticated: false,\r\n    user: null,\r\n    token: localStorage.getItem('token'),\r\n    isLoading: true,\r\n  });\r\n\r\n  const login = useCallback(async (username: string, password: string) => {\r\n    try {\r\n      const response = await authService.login(username, password);\r\n      const { access_token } = response.data;\r\n      \r\n      localStorage.setItem('token', access_token);\r\n      \r\n      // Get user info\r\n      const userResponse = await authService.getCurrentUser();\r\n      const user = userResponse.data;\r\n      \r\n      setAuthState({\r\n        isAuthenticated: true,\r\n        user,\r\n        token: access_token,\r\n        isLoading: false,\r\n      });\r\n      \r\n      return { success: true };\r\n    } catch (error) {\r\n      return { \r\n        success: false, \r\n        error: error instanceof Error ? error.message : 'Login failed' \r\n      };\r\n    }\r\n  }, []);\r\n\r\n  const logout = useCallback(() => {\r\n    localStorage.removeItem('token');\r\n    setAuthState({\r\n      isAuthenticated: false,\r\n      user: null,\r\n      token: null,\r\n      isLoading: false,\r\n    });\r\n  }, []);\r\n\r\n  const checkAuth = useCallback(async () => {\r\n    const token = localStorage.getItem('token');\r\n    \r\n    if (!token) {\r\n      setAuthState(prev => ({ ...prev, isLoading: false }));\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await authService.getCurrentUser();\r\n      const user = response.data;\r\n      \r\n      setAuthState({\r\n        isAuthenticated: true,\r\n        user,\r\n        token,\r\n        isLoading: false,\r\n      });\r\n    } catch (error) {\r\n      // Token is invalid, remove it\r\n      localStorage.removeItem('token');\r\n      setAuthState({\r\n        isAuthenticated: false,\r\n        user: null,\r\n        token: null,\r\n        isLoading: false,\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    checkAuth();\r\n  }, []); // Remove checkAuth dependency to prevent loops\r\n\r\n  return {\r\n    ...authState,\r\n    login,\r\n    logout,\r\n    checkAuth,\r\n  };\r\n};\r\n"],"mappings":"uHAAA,OAASA,QAAQ,CAAEC,SAAS,CAAEC,WAAW,KAAQ,OAAO,CACxD,OAASC,WAAW,KAAQ,yBAAyB,CAcrD,MAAO,MAAM,CAAAC,OAAO,CAAGA,CAAA,GAAM,CAC3B,KAAM,CAACC,SAAS,CAAEC,YAAY,CAAC,CAAGN,QAAQ,CAAY,CACpDO,eAAe,CAAE,KAAK,CACtBC,IAAI,CAAE,IAAI,CACVC,KAAK,CAAEC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CACpCC,SAAS,CAAE,IACb,CAAC,CAAC,CAEF,KAAM,CAAAC,KAAK,CAAGX,WAAW,CAAC,MAAOY,QAAgB,CAAEC,QAAgB,GAAK,CACtE,GAAI,CACF,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAb,WAAW,CAACU,KAAK,CAACC,QAAQ,CAAEC,QAAQ,CAAC,CAC5D,KAAM,CAAEE,YAAa,CAAC,CAAGD,QAAQ,CAACE,IAAI,CAEtCR,YAAY,CAACS,OAAO,CAAC,OAAO,CAAEF,YAAY,CAAC,CAE3C;AACA,KAAM,CAAAG,YAAY,CAAG,KAAM,CAAAjB,WAAW,CAACkB,cAAc,CAAC,CAAC,CACvD,KAAM,CAAAb,IAAI,CAAGY,YAAY,CAACF,IAAI,CAE9BZ,YAAY,CAAC,CACXC,eAAe,CAAE,IAAI,CACrBC,IAAI,CACJC,KAAK,CAAEQ,YAAY,CACnBL,SAAS,CAAE,KACb,CAAC,CAAC,CAEF,MAAO,CAAEU,OAAO,CAAE,IAAK,CAAC,CAC1B,CAAE,MAAOC,KAAK,CAAE,CACd,MAAO,CACLD,OAAO,CAAE,KAAK,CACdC,KAAK,CAAEA,KAAK,WAAY,CAAAC,KAAK,CAAGD,KAAK,CAACE,OAAO,CAAG,cAClD,CAAC,CACH,CACF,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAC,MAAM,CAAGxB,WAAW,CAAC,IAAM,CAC/BQ,YAAY,CAACiB,UAAU,CAAC,OAAO,CAAC,CAChCrB,YAAY,CAAC,CACXC,eAAe,CAAE,KAAK,CACtBC,IAAI,CAAE,IAAI,CACVC,KAAK,CAAE,IAAI,CACXG,SAAS,CAAE,KACb,CAAC,CAAC,CACJ,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAgB,SAAS,CAAG1B,WAAW,CAAC,SAAY,CACxC,KAAM,CAAAO,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAE3C,GAAI,CAACF,KAAK,CAAE,CACVH,YAAY,CAACuB,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAUD,IAAI,MAAEjB,SAAS,CAAE,KAAK,EAAG,CAAC,CACrD,OACF,CAEA,GAAI,CACF,KAAM,CAAAI,QAAQ,CAAG,KAAM,CAAAb,WAAW,CAACkB,cAAc,CAAC,CAAC,CACnD,KAAM,CAAAb,IAAI,CAAGQ,QAAQ,CAACE,IAAI,CAE1BZ,YAAY,CAAC,CACXC,eAAe,CAAE,IAAI,CACrBC,IAAI,CACJC,KAAK,CACLG,SAAS,CAAE,KACb,CAAC,CAAC,CACJ,CAAE,MAAOW,KAAK,CAAE,CACd;AACAb,YAAY,CAACiB,UAAU,CAAC,OAAO,CAAC,CAChCrB,YAAY,CAAC,CACXC,eAAe,CAAE,KAAK,CACtBC,IAAI,CAAE,IAAI,CACVC,KAAK,CAAE,IAAI,CACXG,SAAS,CAAE,KACb,CAAC,CAAC,CACJ,CACF,CAAC,CAAE,EAAE,CAAC,CAENX,SAAS,CAAC,IAAM,CACd2B,SAAS,CAAC,CAAC,CACb,CAAC,CAAE,EAAE,CAAC,CAAE;AAER,OAAAE,aAAA,CAAAA,aAAA,IACKzB,SAAS,MACZQ,KAAK,CACLa,MAAM,CACNE,SAAS,GAEb,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}