{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import{Database,Activity,Play,Square,Download,CheckCircle,Clock,FileText,Zap,Settings,BarChart3,Search}from'lucide-react';import DateSearchTab from'./DateSearchTab';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Phase4Dashboard=()=>{var _progress$documents_p,_progress$total_docum,_progress$overall_pro,_progress$current_bat,_progress$batch_summa,_progress$batch_summa2,_progress$batch_summa3,_status$total_documen;const[status,setStatus]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[activeTab,setActiveTab]=useState('configuration');// Processing Configuration State\nconst[processingMode,setProcessingMode]=useState('all');const[selectedBatch,setSelectedBatch]=useState('');const[collectionPrefix,setCollectionPrefix]=useState('batch');const[availableBatches,setAvailableBatches]=useState([]);// Additional configuration state\nconst[sourceDb,setSourceDb]=useState('Batched-Statutes');const[targetDb,setTargetDb]=useState('Date-Enriched-Batches');const[batchSize,setBatchSize]=useState(100);const[dryRun,setDryRun]=useState(false);const[generateMetadata,setGenerateMetadata]=useState(true);const[testConnStatus,setTestConnStatus]=useState('idle');const[testConnMessage,setTestConnMessage]=useState('');const[testGptStatus,setTestGptStatus]=useState('idle');const[testGptMessage,setTestGptMessage]=useState('');// Processing State\nconst[isProcessing,setIsProcessing]=useState(false);const[progress,setProgress]=useState(null);const[processingComplete,setProcessingComplete]=useState(false);// UI State\nconst[successMessage,setSuccessMessage]=useState(null);// Merge tab state\nconst[metadataFiles,setMetadataFiles]=useState([]);const[metadataDbEntries,setMetadataDbEntries]=useState([]);const[selectedMetadata,setSelectedMetadata]=useState(null);const fetchAvailableBatches=useCallback(async()=>{try{const headers={};const token=localStorage.getItem('access_token')||sessionStorage.getItem('access_token');if(token)headers['Authorization']=\"Bearer \".concat(token);const url=\"/api/v1/phase4/available-batches?db_name=\".concat(encodeURIComponent(sourceDb));const res=await fetch(url,{headers});const data=await res.json();if(data.success){var _data$batches;setAvailableBatches(data.batches||[]);if(((_data$batches=data.batches)===null||_data$batches===void 0?void 0:_data$batches.length)>0&&!selectedBatch){setSelectedBatch(data.batches[0]);}}}catch(e){console.error('Failed to fetch available batches:',e);}},[sourceDb,selectedBatch]);useEffect(()=>{fetchStatus();fetchMetadata();loadConfig();},[fetchAvailableBatches]);// Refetch available batches when sourceDb changes\nuseEffect(()=>{fetchAvailableBatches();},[fetchAvailableBatches]);// Auto-select first available batch when switching to single mode\nuseEffect(()=>{if(processingMode==='single'&&availableBatches.length>0&&!selectedBatch){setSelectedBatch(availableBatches[0]);}},[processingMode,availableBatches,selectedBatch]);const loadConfig=()=>{try{var _cfg$dryRun,_cfg$generateMetadata;const raw=localStorage.getItem('phase4_config');if(!raw)return;const cfg=JSON.parse(raw);setSourceDb(cfg.sourceDb||'Batched-Statutes');setTargetDb(cfg.targetDb||'Date-Enriched-Batches');setCollectionPrefix(cfg.collectionPrefix||'batch');setBatchSize(cfg.batchSize||100);setDryRun((_cfg$dryRun=cfg.dryRun)!==null&&_cfg$dryRun!==void 0?_cfg$dryRun:false);setGenerateMetadata((_cfg$generateMetadata=cfg.generateMetadata)!==null&&_cfg$generateMetadata!==void 0?_cfg$generateMetadata:true);}catch(e){console.error('Failed to load Phase4 config',e);}};const handleSaveConfig=()=>{const cfg={sourceDb,targetDb,collectionPrefix,batchSize,dryRun,generateMetadata};try{localStorage.setItem('phase4_config',JSON.stringify(cfg));// small feedback - keep it minimal\nconsole.info('Phase4 configuration saved');}catch(e){console.error('Failed to save config',e);}};const handleResetConfig=()=>{setSourceDb('Batched-Statutes');setTargetDb('Date-Enriched-Batches');setCollectionPrefix('batch');setBatchSize(100);setDryRun(false);setGenerateMetadata(true);localStorage.removeItem('phase4_config');};const handleTestConnection=async()=>{setTestConnStatus('testing');setTestConnMessage('Testing connection...');try{const token=localStorage.getItem('access_token')||sessionStorage.getItem('access_token');const headers={'Content-Type':'application/json'};if(token)headers['Authorization']=\"Bearer \".concat(token);const body={connection_string:\"\",database_name:sourceDb,test_connection:true};const res=await fetch('/api/v1/database/connect',{method:'POST',headers,body:JSON.stringify(body)});const data=await res.json();if(res.ok&&data.success){var _data$data$collection,_data$data;setTestConnStatus('success');setTestConnMessage('Connection OK â€” '+((_data$data$collection=(_data$data=data.data)===null||_data$data===void 0?void 0:_data$data.collection_count)!==null&&_data$data$collection!==void 0?_data$data$collection:'unknown')+' collections');}else{setTestConnStatus('error');setTestConnMessage(data.detail||data.error||'Connection failed');}}catch(e){setTestConnStatus('error');setTestConnMessage(e.message||String(e));}};const handleTestGpt=async()=>{setTestGptStatus('testing');setTestGptMessage('Testing GPT...');try{const token=localStorage.getItem('access_token')||sessionStorage.getItem('access_token');const headers={};if(token)headers['Authorization']=\"Bearer \".concat(token);const res=await fetch('/api/v1/phase4/test-gpt',{headers});const data=await res.json();if(res.ok&&data.success){setTestGptStatus('success');setTestGptMessage('GPT OK');}else{setTestGptStatus('error');setTestGptMessage(data.message||'GPT test failed');}}catch(e){setTestGptStatus('error');setTestGptMessage(e.message||String(e));}};const fetchStatus=async()=>{try{const headers={};const token=localStorage.getItem('access_token')||sessionStorage.getItem('access_token');if(token)headers['Authorization']=\"Bearer \".concat(token);const res=await fetch('/api/v1/phase4/status',{headers});const data=await res.json();if(data.success){setStatus(data);}setLoading(false);}catch(e){console.error(e);setError('Failed to fetch status');setLoading(false);}};const fetchMetadata=async()=>{try{setLoading(true);setError(null);const headers={};const token=localStorage.getItem('access_token')||sessionStorage.getItem('access_token');if(token)headers['Authorization']=\"Bearer \".concat(token);const res=await fetch('/api/v1/phase4/metadata',{headers});const data=await res.json();if(data.success){setMetadataFiles(data.files||[]);setMetadataDbEntries(data.db_entries||[]);setSuccessMessage('Metadata refreshed successfully');setTimeout(()=>setSuccessMessage(null),3000);}else{setError('Failed to fetch metadata: '+(data.message||'Unknown error'));}}catch(e){console.error('Failed to fetch metadata:',e);setError('Failed to refresh metadata. Please check your connection and try again.');}finally{setLoading(false);}};// fetchAvailableBatches is defined above with useCallback; duplicate removed.\nconst handleStartProcessing=async()=>{try{setIsProcessing(true);setProcessingComplete(false);setProgress(null);setActiveTab('processing');// Auto-navigate to processing tab\nconst headers={'Content-Type':'application/json'};const token=localStorage.getItem('access_token')||sessionStorage.getItem('access_token');if(token)headers['Authorization']=\"Bearer \".concat(token);const requestBody={processing_mode:processingMode,selected_batch:processingMode==='single'?selectedBatch:null,collection_prefix:collectionPrefix,batch_size:batchSize,dry_run:dryRun,// source_collection removed; using batch selector when single mode\ngenerate_metadata:generateMetadata};const response=await fetch('/api/v1/phase4/start-processing',{method:'POST',headers,body:JSON.stringify(requestBody)});if(response.ok){// Start listening for progress updates\nconst eventSource=new EventSource('/api/v1/phase4/processing-progress');eventSource.onmessage=event=>{const data=JSON.parse(event.data);setProgress(data);if(data.status==='completed'){setIsProcessing(false);setProcessingComplete(true);setActiveTab('results');// Auto-navigate to results tab when completed\neventSource.close();fetchStatus();}else if(data.status==='error'){var _data$log_messages;setIsProcessing(false);eventSource.close();setError('Processing failed: '+((_data$log_messages=data.log_messages)===null||_data$log_messages===void 0?void 0:_data$log_messages.slice(-1)[0]));}};eventSource.onerror=()=>{setIsProcessing(false);eventSource.close();setError('Connection to progress stream lost');};}else{setIsProcessing(false);setError('Failed to start processing');}}catch(error){console.error('Failed to start processing:',error);setIsProcessing(false);setError('Failed to start processing');}};const handleStopProcessing=async()=>{try{const headers={};const token=localStorage.getItem('access_token')||sessionStorage.getItem('access_token');if(token)headers['Authorization']=\"Bearer \".concat(token);await fetch('/api/v1/phase4/stop-processing',{method:'POST',headers});setIsProcessing(false);setProgress(null);}catch(error){console.error('Failed to stop processing:',error);}};const handleExportResults=async()=>{try{const headers={};const token=localStorage.getItem('access_token')||sessionStorage.getItem('access_token');if(token)headers['Authorization']=\"Bearer \".concat(token);const response=await fetch('/api/v1/phase4/export-results',{headers});if(response.ok){const blob=await response.blob();const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=\"phase4_date_processed_results_\".concat(new Date().toISOString().split('T')[0],\".xlsx\");document.body.appendChild(a);a.click();window.URL.revokeObjectURL(url);document.body.removeChild(a);}}catch(error){console.error('Failed to export results:',error);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center h-64\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500\"})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 border border-red-200 rounded-lg p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(Database,{className:\"h-5 w-5 text-red-400\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-3\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-red-800\",children:\"Error\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-700\",children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setError(null);fetchStatus();},className:\"mt-2 text-sm text-red-600 hover:text-red-500 underline\",children:\"Try again\"})]})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white shadow rounded-lg p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-2xl font-bold text-gray-900 flex items-center\",children:[/*#__PURE__*/_jsx(Database,{className:\"h-8 w-8 text-blue-600 mr-3\"}),\"Phase 4: Enhanced Date Processing\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mt-1\",children:\"Consolidate date fields and extract missing dates using AI assistance\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-4\",children:(status===null||status===void 0?void 0:status.database_info)&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Target Database\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:\"Date-Enriched-Batches\"})]})})]})}),successMessage&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-green-50 border border-green-200 rounded-lg p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(CheckCircle,{className:\"h-5 w-5 text-green-400\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"ml-3\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-green-700\",children:successMessage})}),/*#__PURE__*/_jsx(\"div\",{className:\"ml-auto pl-3\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setSuccessMessage(null),className:\"inline-flex text-green-400 hover:text-green-500\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"sr-only\",children:\"Dismiss\"}),\"\\xD7\"]})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white shadow rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"nav\",{className:\"-mb-px flex space-x-8\",\"aria-label\":\"Tabs\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('configuration'),className:\"whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm \".concat(activeTab==='configuration'?'border-blue-500 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:[/*#__PURE__*/_jsx(Settings,{className:\"h-5 w-5 inline mr-2\"}),\"Configuration\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:async()=>{setActiveTab('merge');// fetch metadata list\ntry{const res=await fetch('/api/v1/phase4/metadata');const data=await res.json();if(data.success){setMetadataFiles(data.files||[]);setMetadataDbEntries(data.db_entries||[]);}}catch(e){console.error('Failed to fetch metadata',e);}},className:\"whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm \".concat(activeTab==='merge'?'border-green-500 text-green-600 bg-green-50':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:[/*#__PURE__*/_jsx(FileText,{className:\"h-5 w-5 inline mr-2\"}),\"Date Merge\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('search'),className:\"whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm \".concat(activeTab==='search'?'border-purple-500 text-purple-600 bg-purple-50':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:[/*#__PURE__*/_jsx(Search,{className:\"h-5 w-5 inline mr-2\"}),\"Date Search\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('processing'),className:\"whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm \".concat(activeTab==='processing'?'border-blue-500 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:[/*#__PURE__*/_jsx(Activity,{className:\"h-5 w-5 inline mr-2\"}),\"Processing\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('results'),className:\"whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm \".concat(activeTab==='results'?'border-blue-500 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:[/*#__PURE__*/_jsx(BarChart3,{className:\"h-5 w-5 inline mr-2\"}),\"Results & Export\"]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[activeTab==='configuration'&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(Settings,{className:\"h-5 w-5 text-gray-600 mr-2\"}),\"Configuration\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Source Database\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:sourceDb,onChange:e=>setSourceDb(e.target.value),className:\"w-full px-3 py-2 border border-gray-300 rounded-md\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleTestConnection,className:\"px-3 py-2 bg-blue-600 text-white rounded-md\",children:\"Test\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleTestGpt,className:\"px-3 py-2 bg-indigo-600 text-white rounded-md\",children:\"Test GPT\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:\"Click Test to verify backend connection to the configured backend MongoDB (backend config is used).\"}),testConnStatus!=='idle'&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 text-sm \".concat(testConnStatus==='success'?'text-green-700':'text-red-700'),children:testConnMessage}),testGptStatus!=='idle'&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 text-sm \".concat(testGptStatus==='success'?'text-green-700':'text-red-700'),children:testGptMessage})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Target Database\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:targetDb,onChange:e=>setTargetDb(e.target.value),className:\"w-full px-3 py-2 border border-gray-300 rounded-md\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-3\",children:\"Processing Mode\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"all\",checked:processingMode==='all',onChange:e=>setProcessingMode(e.target.value),className:\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-sm text-gray-700\",children:\"Process All Batches\"})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"single\",checked:processingMode==='single',onChange:e=>setProcessingMode(e.target.value),className:\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-sm text-gray-700\",children:\"Process Single Batch\"})]})]})]}),processingMode==='single'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Select Batch\"}),/*#__PURE__*/_jsx(\"select\",{value:selectedBatch,onChange:e=>setSelectedBatch(e.target.value),className:\"w-full px-3 py-2 border border-gray-300 rounded-md\",children:availableBatches.map(batch=>/*#__PURE__*/_jsx(\"option\",{value:batch,children:batch},batch))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"md:col-span-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Target Collection Prefix\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:collectionPrefix,onChange:e=>setCollectionPrefix(e.target.value),placeholder:\"e.g., batch, filled, processed\",className:\"w-full px-3 py-2 border border-gray-300 rounded-md\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:[\"Output collections will be named: \",collectionPrefix,\"_1, \",collectionPrefix,\"_2, etc.\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Batch Size\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:batchSize,onChange:e=>setBatchSize(Number(e.target.value)||1),min:1,className:\"w-full px-3 py-2 border border-gray-300 rounded-md\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:\"Number of documents to process per chunk (performance tuning).\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"md:col-span-2 border-l pl-4\",children:/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center text-sm font-medium text-gray-700 mb-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:dryRun,onChange:e=>setDryRun(e.target.checked),className:\"mr-2\"}),\"Dry Run (do not write to target DB)\"]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center text-sm font-medium text-gray-700\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:generateMetadata,onChange:e=>setGenerateMetadata(e.target.checked),className:\"mr-2\"}),\"Generate and save metadata for this run\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:\"When enabled, per-batch and overall metadata will be saved to the server metadata folder and the database.\"})]}),availableBatches.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-2\",children:[/*#__PURE__*/_jsx(Database,{className:\"h-4 w-4 text-blue-600 mr-2\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-blue-800\",children:\"Available Source Batches\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap gap-2\",children:availableBatches.map(batch=>/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-md font-mono\",children:batch},batch))}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-blue-600 mt-2\",children:[\"Total: \",availableBatches.length,\" batch\",availableBatches.length!==1?'es':'',\" ready for processing\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6 p-4 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-semibold text-green-800 mb-2\",children:\"Configuration Complete\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-green-700 space-y-1\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u2022 Processing mode: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium capitalize\",children:processingMode})]}),processingMode==='single'&&selectedBatch&&/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u2022 Selected batch: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium font-mono\",children:selectedBatch})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u2022 Target collection prefix: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium font-mono\",children:collectionPrefix})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u2022 Chunk size: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:batchSize}),\" documents per batch\"]}),dryRun&&/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u2022 \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-orange-600\",children:\"Dry run mode enabled\"}),\" (no data will be written)\"]})]})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('merge'),className:\"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium shadow-sm\",children:[/*#__PURE__*/_jsx(FileText,{className:\"h-4 w-4 mr-2\"}),\"Start Date Merge\"]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center pt-4 border-t border-gray-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleSaveConfig,className:\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm font-medium\",children:\"Save Configuration\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleResetConfig,className:\"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors text-sm border border-gray-300\",children:\"Reset to Defaults\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:\"Configuration saved automatically\"})]})]})]}),activeTab==='processing'&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(Activity,{className:\"h-5 w-5 text-gray-600 mr-2\"}),\"Processing Control\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[!isProcessing?/*#__PURE__*/_jsxs(\"button\",{onClick:handleStartProcessing,disabled:processingMode==='single'&&!selectedBatch,className:\"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed\",children:[/*#__PURE__*/_jsx(Play,{className:\"h-4 w-4 mr-2\"}),\"Start Processing\"]}):/*#__PURE__*/_jsxs(\"button\",{onClick:handleStopProcessing,className:\"flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700\",children:[/*#__PURE__*/_jsx(Square,{className:\"h-4 w-4 mr-2\"}),\"Stop Processing\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-2 text-sm text-gray-600\",children:isProcessing?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Clock,{className:\"h-4 w-4 text-orange-500\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Processing...\"})]}):processingComplete?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"h-4 w-4 text-green-500\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Completed\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Activity,{className:\"h-4 w-4 text-gray-400\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Ready\"})]})})]}),(isProcessing||progress)&&/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:progress&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-700\",children:\"Overall Progress\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-600\",children:[progress.documents_processed,\"/\",progress.total_documents,\" documents\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full bg-gray-200 rounded-full h-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-blue-600 h-2 rounded-full transition-all duration-300\",style:{width:\"\".concat(progress.overall_progress,\"%\")}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right text-xs text-gray-500 mt-1\",children:[progress.overall_progress.toFixed(1),\"%\"]})]}),progress.current_batch&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium text-gray-700\",children:[\"Current Batch: \",progress.current_batch]}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-600\",children:[progress.current_batch_progress.toFixed(1),\"%\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full bg-gray-200 rounded-full h-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-green-500 h-2 rounded-full transition-all duration-300\",style:{width:\"\".concat(progress.current_batch_progress,\"%\")}})})]}),progress.current_document&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 rounded-lg p-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(FileText,{className:\"h-4 w-4 text-gray-500 mr-2\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium\",children:\"Processing:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-700 ml-2 truncate\",children:progress.current_document})]})}),progress.batch_summary&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-green-50 p-3 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-green-800\",children:\"Completed\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-green-900\",children:progress.batch_summary.completed_batches.length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-green-600\",children:progress.batch_summary.completed_batches.slice(-3).join(', ')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-50 p-3 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-blue-800\",children:\"Current\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-blue-900\",children:progress.batch_summary.current_batch||'None'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 p-3 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-800\",children:\"Remaining\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-gray-900\",children:progress.batch_summary.remaining_batches.length})]})]})]})}),(progress===null||progress===void 0?void 0:progress.log_messages)&&progress.log_messages.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-md font-semibold mb-3 flex items-center\",children:[/*#__PURE__*/_jsx(Zap,{className:\"h-4 w-4 text-gray-600 mr-2\"}),\"Live Processing Log\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-900 text-green-400 font-mono text-sm p-4 rounded-lg max-h-64 overflow-y-auto\",children:progress.log_messages.slice(-20).map((message,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"mb-1\",children:message},index))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setActiveTab('configuration'),className:\"flex items-center px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50\",children:\"Back to Configuration\"}),processingComplete&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('results'),className:\"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700\",children:[\"View Results\",/*#__PURE__*/_jsx(BarChart3,{className:\"h-4 w-4 ml-2\"})]})]})]}),activeTab==='merge'&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold flex items-center\",children:[/*#__PURE__*/_jsx(FileText,{className:\"h-5 w-5 text-gray-600 mr-2\"}),\"Date Field Merge Processing\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-2 text-sm\",children:isProcessing?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-orange-600\",children:[/*#__PURE__*/_jsx(Clock,{className:\"h-4 w-4 mr-1 animate-pulse\"}),\"Processing...\"]}):processingComplete?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-green-600\",children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"h-4 w-4 mr-1\"}),\"Completed\"]}):/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-gray-500\",children:[/*#__PURE__*/_jsx(Activity,{className:\"h-4 w-4 mr-1\"}),\"Ready to Merge\"]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-lg font-semibold text-blue-900\",children:\"Date Field Merge\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-blue-700 text-sm mt-1\",children:\"Consolidate Date and Promulgation_Date fields into a single Date field\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-3\",children:!isProcessing?/*#__PURE__*/_jsxs(\"button\",{onClick:async()=>{// Enhanced merge processing\nconst requestBody={processing_mode:processingMode,selected_batch:processingMode==='single'?selectedBatch:null,collection_prefix:collectionPrefix,batch_size:batchSize,dry_run:dryRun,generate_metadata:generateMetadata};try{setIsProcessing(true);setProcessingComplete(false);setProgress(null);const res=await fetch('/api/v1/phase4/start-processing',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(requestBody)});if(res.ok){// Start listening for progress updates\nconst eventSource=new EventSource('/api/v1/phase4/processing-progress');eventSource.onmessage=event=>{const data=JSON.parse(event.data);setProgress(data);if(data.status==='completed'){setIsProcessing(false);setProcessingComplete(true);eventSource.close();// Refresh metadata and status\nfetchMetadata();fetchStatus();}};eventSource.onerror=()=>{setIsProcessing(false);eventSource.close();};}else{setIsProcessing(false);alert('Failed to start merge processing');}}catch(e){setIsProcessing(false);console.error(e);alert('Failed to start merge processing');}},disabled:processingMode==='single'&&!selectedBatch||isProcessing,className:\"flex items-center px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-700 hover:to-green-800 disabled:bg-gray-400 disabled:cursor-not-allowed font-medium shadow-lg\",children:[/*#__PURE__*/_jsx(Play,{className:\"h-5 w-5 mr-2\"}),\"Start Date Merge\"]}):/*#__PURE__*/_jsxs(\"button\",{onClick:handleStopProcessing,className:\"flex items-center px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-lg hover:from-red-700 hover:to-red-800 font-medium shadow-lg\",children:[/*#__PURE__*/_jsx(Square,{className:\"h-5 w-5 mr-2\"}),\"Stop Processing\"]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/70 rounded-lg p-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-600 font-medium\",children:\"Mode\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-blue-900 font-semibold capitalize\",children:processingMode})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/70 rounded-lg p-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-600 font-medium\",children:\"Batch\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-blue-900 font-semibold\",children:processingMode==='single'?selectedBatch||'None':'All Batches'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/70 rounded-lg p-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-600 font-medium\",children:\"Chunk Size\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-blue-900 font-semibold\",children:batchSize})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/70 rounded-lg p-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-600 font-medium\",children:\"Dry Run\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-blue-900 font-semibold\",children:dryRun?'Yes':'No'})]})]})]}),(isProcessing||progress)&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white border border-gray-200 rounded-xl p-6 shadow-sm\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-lg font-semibold mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(Activity,{className:\"h-5 w-5 text-blue-600 mr-2\"}),\"Processing Progress\"]}),progress&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-3\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-700\",children:\"Overall Progress\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-semibold text-gray-900\",children:[(_progress$documents_p=progress.documents_processed)===null||_progress$documents_p===void 0?void 0:_progress$documents_p.toLocaleString(),\"/\",(_progress$total_docum=progress.total_documents)===null||_progress$total_docum===void 0?void 0:_progress$total_docum.toLocaleString(),\" documents\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"relative w-full bg-gray-200 rounded-full h-3\",children:/*#__PURE__*/_jsx(\"div\",{className:\"absolute left-0 top-0 bg-gradient-to-r from-blue-500 to-blue-600 h-3 rounded-full transition-all duration-500 flex items-center justify-end pr-2\",style:{width:\"\".concat(Math.max(progress.overall_progress,0),\"%\")},children:/*#__PURE__*/_jsxs(\"span\",{className:\"text-white text-xs font-bold\",children:[(_progress$overall_pro=progress.overall_progress)===null||_progress$overall_pro===void 0?void 0:_progress$overall_pro.toFixed(1),\"%\"]})})})]}),progress.current_batch&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-3\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium text-gray-700\",children:[\"Current Batch: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-gray-900\",children:progress.current_batch})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-semibold text-gray-900\",children:[(_progress$current_bat=progress.current_batch_progress)===null||_progress$current_bat===void 0?void 0:_progress$current_bat.toFixed(1),\"%\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"relative w-full bg-gray-200 rounded-full h-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"absolute left-0 top-0 bg-gradient-to-r from-green-500 to-green-600 h-2 rounded-full transition-all duration-500\",style:{width:\"\".concat(Math.max(progress.current_batch_progress||0,0),\"%\")}})})]}),progress.current_document&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-r from-gray-50 to-blue-50 rounded-lg p-4 border-l-4 border-blue-500\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start\",children:[/*#__PURE__*/_jsx(FileText,{className:\"h-5 w-5 text-blue-600 mr-3 mt-0.5 flex-shrink-0\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-700 mb-1\",children:\"Currently Processing:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-900 font-mono bg-white px-2 py-1 rounded border\",children:progress.current_document})]})]})}),progress.batch_summary&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200 p-4 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-2\",children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"h-5 w-5 text-green-600 mr-2\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-green-800\",children:\"Completed Batches\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-green-900\",children:((_progress$batch_summa=progress.batch_summary.completed_batches)===null||_progress$batch_summa===void 0?void 0:_progress$batch_summa.length)||0}),((_progress$batch_summa2=progress.batch_summary.completed_batches)===null||_progress$batch_summa2===void 0?void 0:_progress$batch_summa2.length)>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-green-600 mt-1 truncate\",children:[\"Latest: \",progress.batch_summary.completed_batches.slice(-1)[0]]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 p-4 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-2\",children:[/*#__PURE__*/_jsx(Activity,{className:\"h-5 w-5 text-blue-600 mr-2\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-blue-800\",children:\"Current Batch\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-blue-900\",children:progress.batch_summary.current_batch||'None'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-br from-gray-50 to-slate-50 border border-gray-200 p-4 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-2\",children:[/*#__PURE__*/_jsx(Clock,{className:\"h-5 w-5 text-gray-600 mr-2\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-800\",children:\"Remaining Batches\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-gray-900\",children:((_progress$batch_summa3=progress.batch_summary.remaining_batches)===null||_progress$batch_summa3===void 0?void 0:_progress$batch_summa3.length)||0})]})]}),(progress===null||progress===void 0?void 0:progress.log_messages)&&progress.log_messages.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h5\",{className:\"text-md font-semibold mb-3 flex items-center\",children:[/*#__PURE__*/_jsx(Zap,{className:\"h-4 w-4 text-yellow-600 mr-2\"}),\"Live Processing Log\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-900 text-green-400 font-mono text-sm p-4 rounded-lg max-h-48 overflow-y-auto border\",children:progress.log_messages.slice(-15).map((message,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"mb-1 leading-relaxed\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-green-500\",children:[\"[\",new Date().toLocaleTimeString(),\"]\"]}),\" \",message]},index))})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white border border-gray-200 rounded-xl p-6 shadow-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-md font-semibold text-gray-900\",children:\"Metadata Files\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:async()=>{try{await fetchMetadata();}catch(e){console.error('Refresh failed:',e);}},disabled:loading,className:\"flex items-center px-3 py-1.5 text-sm bg-blue-50 text-blue-600 hover:bg-blue-100 hover:text-blue-700 disabled:bg-gray-50 disabled:text-gray-400 rounded-md transition-colors border border-blue-200\",children:[loading?/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin h-3 w-3 border-2 border-blue-600 border-t-transparent rounded-full mr-1\"}):/*#__PURE__*/_jsx(Activity,{className:\"h-3 w-3 mr-1\"}),loading?'Refreshing...':'Refresh']})]}),/*#__PURE__*/_jsx(\"div\",{className:\"max-h-64 overflow-y-auto\",children:metadataFiles.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500 py-8 text-center\",children:[\"No metadata files found.\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:\"Run processing to generate metadata\"})]}):metadataFiles.map(f=>/*#__PURE__*/_jsx(\"div\",{className:\"p-3 rounded-lg hover:bg-gray-50 cursor-pointer border mb-2 transition-colors \".concat((selectedMetadata===null||selectedMetadata===void 0?void 0:selectedMetadata.filename)===f.filename?'bg-blue-50 border-blue-200':'border-gray-200'),onClick:()=>setSelectedMetadata(f),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-900 mb-1\",children:f.filename}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[\"Modified: \",new Date(f.modified*1000).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded\",children:[(f.size/1024).toFixed(1),\" KB\"]})]})},f.filename))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white border border-gray-200 rounded-xl p-6 shadow-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-md font-semibold text-gray-900\",children:\"Database Results\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:async()=>{try{await fetchStatus();}catch(e){console.error('Refresh failed:',e);}},disabled:loading,className:\"flex items-center px-3 py-1.5 text-sm bg-green-50 text-green-600 hover:bg-green-100 hover:text-green-700 disabled:bg-gray-50 disabled:text-gray-400 rounded-md transition-colors border border-green-200\",children:[loading?/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin h-3 w-3 border-2 border-green-600 border-t-transparent rounded-full mr-1\"}):/*#__PURE__*/_jsx(Database,{className:\"h-3 w-3 mr-1\"}),loading?'Refreshing...':'Refresh']})]}),/*#__PURE__*/_jsx(\"div\",{className:\"max-h-64 overflow-y-auto\",children:metadataDbEntries.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500 py-8 text-center\",children:[\"No database entries found.\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:\"Run processing to create target collections\"})]}):metadataDbEntries.map(d=>{var _d$processed,_d$total_documents;return/*#__PURE__*/_jsx(\"div\",{className:\"p-3 rounded-lg hover:bg-gray-50 border border-gray-200 mb-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-900\",children:d.batch}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[\"Target: \",d.target_collection]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-semibold text-green-600\",children:(_d$processed=d.processed)===null||_d$processed===void 0?void 0:_d$processed.toLocaleString()}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[\"/ \",(_d$total_documents=d.total_documents)===null||_d$total_documents===void 0?void 0:_d$total_documents.toLocaleString()]})]})]})},d._id);})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between pt-4 border-t border-gray-200\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:async()=>{if(!selectedMetadata){alert('Please select a metadata file first');return;}try{const res=await fetch('/api/v1/phase4/metadata');const data=await res.json();const fileInfo=data.files.find(x=>x.filename===selectedMetadata.filename);if(!fileInfo)return;const fileRes=await fetch('/api/v1/phase4/metadata?batch='+encodeURIComponent(selectedMetadata.filename));const fileJson=await fileRes.json();const blob=new Blob([JSON.stringify(fileJson,null,2)],{type:'application/json'});const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=selectedMetadata.filename;document.body.appendChild(a);a.click();window.URL.revokeObjectURL(url);document.body.removeChild(a);}catch(e){console.error('Failed to download metadata',e);alert('Failed to download metadata file');}},disabled:!selectedMetadata,className:\"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed\",children:[/*#__PURE__*/_jsx(Download,{className:\"h-4 w-4 mr-2\"}),\"Download Metadata\"]}),processingComplete&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('results'),className:\"flex items-center px-6 py-2 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-700 hover:to-green-800 font-medium\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"h-4 w-4 mr-2\"}),\"View Results & Export\"]})]}),selectedMetadata&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 border border-gray-200 rounded-xl p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-3\",children:[/*#__PURE__*/_jsx(FileText,{className:\"h-4 w-4 text-gray-600 mr-2\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium text-gray-900\",children:[\"Preview: \",selectedMetadata.filename]})]}),/*#__PURE__*/_jsx(\"pre\",{className:\"text-xs font-mono bg-white border rounded-lg p-3 max-h-32 overflow-y-auto\",children:JSON.stringify(metadataDbEntries.find(d=>d.batch&&selectedMetadata.filename.includes(d.batch))||{},null,2)})]})]}),activeTab==='results'&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"h-5 w-5 text-gray-600 mr-2\"}),\"Results & Export\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-green-50 border border-green-200 rounded-lg p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-lg font-semibold text-green-800\",children:\"Processing Complete!\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-green-700 mt-1\",children:\"Your date enrichment processing has finished successfully. You can now export the results.\"})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleExportResults,className:\"flex items-center px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold\",children:[/*#__PURE__*/_jsx(Download,{className:\"h-5 w-5 mr-2\"}),\"Export to Excel\"]})]})}),status&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-md font-semibold mb-3\",children:\"Processing Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-50 p-4 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-blue-800\",children:\"Current Phase\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-blue-900\",children:status.current_phase})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-green-50 p-4 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-green-800\",children:\"Total Documents\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-green-900\",children:((_status$total_documen=status.total_documents)===null||_status$total_documen===void 0?void 0:_status$total_documen.toLocaleString())||'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-purple-50 p-4 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-purple-800\",children:\"Status\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-purple-900\",children:status.status})]})]})]}),(progress===null||progress===void 0?void 0:progress.batch_summary)&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-md font-semibold mb-3\",children:\"Batch Processing Results\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-green-50 p-4 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-green-800\",children:\"Completed Batches\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-green-900\",children:progress.batch_summary.completed_batches.length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-green-600 mt-2\",children:progress.batch_summary.completed_batches.join(', ')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-50 p-4 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-blue-800\",children:\"Documents Processed\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-blue-900\",children:progress.documents_processed.toLocaleString()})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-purple-50 p-4 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-purple-800\",children:\"Success Rate\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-lg font-bold text-purple-900\",children:[progress.overall_progress.toFixed(1),\"%\"]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setActiveTab('processing'),className:\"flex items-center px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50\",children:\"Back to Processing\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setActiveTab('configuration');setProcessingComplete(false);setProgress(null);},className:\"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\",children:\"Start New Processing\"})]})]}),activeTab==='search'&&/*#__PURE__*/_jsx(DateSearchTab,{})]})]})]});};export default Phase4Dashboard;","map":{"version":3,"names":["React","useState","useEffect","useCallback","Database","Activity","Play","Square","Download","CheckCircle","Clock","FileText","Zap","Settings","BarChart3","Search","DateSearchTab","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Phase4Dashboard","_progress$documents_p","_progress$total_docum","_progress$overall_pro","_progress$current_bat","_progress$batch_summa","_progress$batch_summa2","_progress$batch_summa3","_status$total_documen","status","setStatus","loading","setLoading","error","setError","activeTab","setActiveTab","processingMode","setProcessingMode","selectedBatch","setSelectedBatch","collectionPrefix","setCollectionPrefix","availableBatches","setAvailableBatches","sourceDb","setSourceDb","targetDb","setTargetDb","batchSize","setBatchSize","dryRun","setDryRun","generateMetadata","setGenerateMetadata","testConnStatus","setTestConnStatus","testConnMessage","setTestConnMessage","testGptStatus","setTestGptStatus","testGptMessage","setTestGptMessage","isProcessing","setIsProcessing","progress","setProgress","processingComplete","setProcessingComplete","successMessage","setSuccessMessage","metadataFiles","setMetadataFiles","metadataDbEntries","setMetadataDbEntries","selectedMetadata","setSelectedMetadata","fetchAvailableBatches","headers","token","localStorage","getItem","sessionStorage","concat","url","encodeURIComponent","res","fetch","data","json","success","_data$batches","batches","length","e","console","fetchStatus","fetchMetadata","loadConfig","_cfg$dryRun","_cfg$generateMetadata","raw","cfg","JSON","parse","handleSaveConfig","setItem","stringify","info","handleResetConfig","removeItem","handleTestConnection","body","connection_string","database_name","test_connection","method","ok","_data$data$collection","_data$data","collection_count","detail","message","String","handleTestGpt","files","db_entries","setTimeout","handleStartProcessing","requestBody","processing_mode","selected_batch","collection_prefix","batch_size","dry_run","generate_metadata","response","eventSource","EventSource","onmessage","event","close","_data$log_messages","log_messages","slice","onerror","handleStopProcessing","handleExportResults","blob","window","URL","createObjectURL","a","document","createElement","href","download","Date","toISOString","split","appendChild","click","revokeObjectURL","removeChild","className","children","onClick","database_info","type","value","onChange","target","checked","map","batch","placeholder","Number","min","disabled","documents_processed","total_documents","style","width","overall_progress","toFixed","current_batch","current_batch_progress","current_document","batch_summary","completed_batches","join","remaining_batches","index","alert","toLocaleString","Math","max","toLocaleTimeString","f","filename","modified","size","d","_d$processed","_d$total_documents","target_collection","processed","_id","fileInfo","find","x","fileRes","fileJson","Blob","includes","current_phase"],"sources":["D:/DigiFloat/LawChronicle/frontend/src/components/Phase4Dashboard.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\r\nimport { \r\n  Database,\r\n  Activity,\r\n  Play,\r\n  Square,\r\n  Download,\r\n  CheckCircle,\r\n  Clock,\r\n  FileText,\r\n  Zap,\r\n  Settings,\r\n  BarChart3,\r\n  Search\r\n} from 'lucide-react';\r\nimport DateSearchTab from './DateSearchTab';\r\n\r\ninterface Phase4Status {\r\n  current_phase: string;\r\n  total_documents?: number;\r\n  processed_documents?: number;\r\n  status: string;\r\n  available_batches?: string[];\r\n  database_info?: {\r\n    source_db: string;\r\n    target_db: string;\r\n    collections_count: number;\r\n  };\r\n}\r\n\r\ninterface ProcessingProgress {\r\n  overall_progress: number;\r\n  current_batch_progress: number;\r\n  current_document: string;\r\n  current_batch: string;\r\n  documents_processed: number;\r\n  total_documents: number;\r\n  status: string;\r\n  log_messages: string[];\r\n  batch_summary?: {\r\n    completed_batches: string[];\r\n    current_batch: string;\r\n    remaining_batches: string[];\r\n  };\r\n}\r\n\r\nconst Phase4Dashboard: React.FC = () => {\r\n  const [status, setStatus] = useState<Phase4Status | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [activeTab, setActiveTab] = useState<'configuration' | 'processing' | 'results' | 'merge' | 'search'>('configuration');\r\n\r\n  // Processing Configuration State\r\n  const [processingMode, setProcessingMode] = useState<'single' | 'all'>('all');\r\n  const [selectedBatch, setSelectedBatch] = useState<string>('');\r\n  const [collectionPrefix, setCollectionPrefix] = useState('batch');\r\n  const [availableBatches, setAvailableBatches] = useState<string[]>([]);\r\n  // Additional configuration state\r\n  const [sourceDb, setSourceDb] = useState('Batched-Statutes');\r\n  const [targetDb, setTargetDb] = useState('Date-Enriched-Batches');\r\n  const [batchSize, setBatchSize] = useState<number>(100);\r\n  const [dryRun, setDryRun] = useState<boolean>(false);\r\n  const [generateMetadata, setGenerateMetadata] = useState<boolean>(true);\r\n  const [testConnStatus, setTestConnStatus] = useState<'idle' | 'testing' | 'success' | 'error'>('idle');\r\n  const [testConnMessage, setTestConnMessage] = useState<string>('');\r\n  const [testGptStatus, setTestGptStatus] = useState<'idle' | 'testing' | 'success' | 'error'>('idle');\r\n  const [testGptMessage, setTestGptMessage] = useState<string>('');\r\n  \r\n  // Processing State\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [progress, setProgress] = useState<ProcessingProgress | null>(null);\r\n  const [processingComplete, setProcessingComplete] = useState(false);\r\n  \r\n  // UI State\r\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\r\n  // Merge tab state\r\n  const [metadataFiles, setMetadataFiles] = useState<any[]>([]);\r\n  const [metadataDbEntries, setMetadataDbEntries] = useState<any[]>([]);\r\n  const [selectedMetadata, setSelectedMetadata] = useState<any | null>(null);\r\n\r\n  const fetchAvailableBatches = useCallback(async () => {\r\n    try {\r\n      const headers: any = {};\r\n      const token = localStorage.getItem('access_token') || sessionStorage.getItem('access_token');\r\n      if (token) headers['Authorization'] = `Bearer ${token}`;\r\n      const url = `/api/v1/phase4/available-batches?db_name=${encodeURIComponent(sourceDb)}`;\r\n      const res = await fetch(url, { headers });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setAvailableBatches(data.batches || []);\r\n        if (data.batches?.length > 0 && !selectedBatch) {\r\n          setSelectedBatch(data.batches[0]);\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to fetch available batches:', e);\r\n    }\r\n  }, [sourceDb, selectedBatch]);\r\n\r\n  useEffect(() => {\r\n    fetchStatus();\r\n    fetchMetadata();\r\n    loadConfig();\r\n  }, [fetchAvailableBatches]);\r\n\r\n  // Refetch available batches when sourceDb changes\r\n  useEffect(() => {\r\n    fetchAvailableBatches();\r\n  }, [fetchAvailableBatches]);\r\n\r\n  // Auto-select first available batch when switching to single mode\r\n  useEffect(() => {\r\n    if (processingMode === 'single' && availableBatches.length > 0 && !selectedBatch) {\r\n      setSelectedBatch(availableBatches[0]);\r\n    }\r\n  }, [processingMode, availableBatches, selectedBatch]);\r\n\r\n  const loadConfig = () => {\r\n    try {\r\n      const raw = localStorage.getItem('phase4_config');\r\n      if (!raw) return;\r\n      const cfg = JSON.parse(raw);\r\n      setSourceDb(cfg.sourceDb || 'Batched-Statutes');\r\n      setTargetDb(cfg.targetDb || 'Date-Enriched-Batches');\r\n      setCollectionPrefix(cfg.collectionPrefix || 'batch');\r\n      setBatchSize(cfg.batchSize || 100);\r\n      setDryRun(cfg.dryRun ?? false);\r\n  setGenerateMetadata(cfg.generateMetadata ?? true);\r\n    } catch (e) {\r\n      console.error('Failed to load Phase4 config', e);\r\n    }\r\n  };\r\n\r\n  const handleSaveConfig = () => {\r\n    const cfg = {\r\n      sourceDb,\r\n      targetDb,\r\n      collectionPrefix,\r\n      batchSize,\r\n      dryRun\r\n  ,\r\n  generateMetadata\r\n    };\r\n    try {\r\n      localStorage.setItem('phase4_config', JSON.stringify(cfg));\r\n      // small feedback - keep it minimal\r\n      console.info('Phase4 configuration saved');\r\n    } catch (e) {\r\n      console.error('Failed to save config', e);\r\n    }\r\n  };\r\n\r\n  const handleResetConfig = () => {\r\n    setSourceDb('Batched-Statutes');\r\n    setTargetDb('Date-Enriched-Batches');\r\n    setCollectionPrefix('batch');\r\n    setBatchSize(100);\r\n    setDryRun(false);\r\n  setGenerateMetadata(true);\r\n    localStorage.removeItem('phase4_config');\r\n  };\r\n\r\n  const handleTestConnection = async () => {\r\n    setTestConnStatus('testing');\r\n    setTestConnMessage('Testing connection...');\r\n    try {\r\n      const token = localStorage.getItem('access_token') || sessionStorage.getItem('access_token');\r\n      const headers: any = { 'Content-Type': 'application/json' };\r\n      if (token) headers['Authorization'] = `Bearer ${token}`;\r\n\r\n      const body = {\r\n        connection_string: \"\",\r\n        database_name: sourceDb,\r\n        test_connection: true\r\n      };\r\n\r\n      const res = await fetch('/api/v1/database/connect', {\r\n        method: 'POST',\r\n        headers,\r\n        body: JSON.stringify(body)\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (res.ok && data.success) {\r\n        setTestConnStatus('success');\r\n        setTestConnMessage('Connection OK â€” ' + (data.data?.collection_count ?? 'unknown') + ' collections');\r\n      } else {\r\n        setTestConnStatus('error');\r\n        setTestConnMessage(data.detail || data.error || 'Connection failed');\r\n      }\r\n    } catch (e: any) {\r\n      setTestConnStatus('error');\r\n      setTestConnMessage(e.message || String(e));\r\n    }\r\n  };\r\n\r\n  const handleTestGpt = async () => {\r\n    setTestGptStatus('testing');\r\n    setTestGptMessage('Testing GPT...');\r\n    try {\r\n      const token = localStorage.getItem('access_token') || sessionStorage.getItem('access_token');\r\n      const headers: any = {};\r\n      if (token) headers['Authorization'] = `Bearer ${token}`;\r\n\r\n      const res = await fetch('/api/v1/phase4/test-gpt', { headers });\r\n      const data = await res.json();\r\n      if (res.ok && data.success) {\r\n        setTestGptStatus('success');\r\n        setTestGptMessage('GPT OK');\r\n      } else {\r\n        setTestGptStatus('error');\r\n        setTestGptMessage(data.message || 'GPT test failed');\r\n      }\r\n    } catch (e: any) {\r\n      setTestGptStatus('error');\r\n      setTestGptMessage(e.message || String(e));\r\n    }\r\n  };\r\n\r\n  const fetchStatus = async () => {\r\n    try {\r\n      const headers: any = {};\r\n      const token = localStorage.getItem('access_token') || sessionStorage.getItem('access_token');\r\n      if (token) headers['Authorization'] = `Bearer ${token}`;\r\n      \r\n      const res = await fetch('/api/v1/phase4/status', { headers });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setStatus(data);\r\n      }\r\n      setLoading(false);\r\n    } catch (e) {\r\n      console.error(e);\r\n      setError('Failed to fetch status');\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchMetadata = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      const headers: any = {};\r\n      const token = localStorage.getItem('access_token') || sessionStorage.getItem('access_token');\r\n      if (token) headers['Authorization'] = `Bearer ${token}`;\r\n      \r\n      const res = await fetch('/api/v1/phase4/metadata', { headers });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMetadataFiles(data.files || []);\r\n        setMetadataDbEntries(data.db_entries || []);\r\n        setSuccessMessage('Metadata refreshed successfully');\r\n        setTimeout(() => setSuccessMessage(null), 3000);\r\n      } else {\r\n        setError('Failed to fetch metadata: ' + (data.message || 'Unknown error'));\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to fetch metadata:', e);\r\n      setError('Failed to refresh metadata. Please check your connection and try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // fetchAvailableBatches is defined above with useCallback; duplicate removed.\r\n\r\n  const handleStartProcessing = async () => {\r\n    try {\r\n      setIsProcessing(true);\r\n      setProcessingComplete(false);\r\n      setProgress(null);\r\n      setActiveTab('processing'); // Auto-navigate to processing tab\r\n      \r\n      const headers: any = { 'Content-Type': 'application/json' };\r\n      const token = localStorage.getItem('access_token') || sessionStorage.getItem('access_token');\r\n      if (token) headers['Authorization'] = `Bearer ${token}`;\r\n      \r\n      const requestBody = {\r\n        processing_mode: processingMode,\r\n        selected_batch: processingMode === 'single' ? selectedBatch : null,\r\n  collection_prefix: collectionPrefix,\r\n  batch_size: batchSize,\r\n  dry_run: dryRun,\r\n  // source_collection removed; using batch selector when single mode\r\n  generate_metadata: generateMetadata\r\n      };\r\n      \r\n      const response = await fetch('/api/v1/phase4/start-processing', {\r\n        method: 'POST',\r\n        headers,\r\n        body: JSON.stringify(requestBody)\r\n      });\r\n      \r\n      if (response.ok) {\r\n        // Start listening for progress updates\r\n        const eventSource = new EventSource('/api/v1/phase4/processing-progress');\r\n        eventSource.onmessage = (event) => {\r\n          const data: ProcessingProgress = JSON.parse(event.data);\r\n          setProgress(data);\r\n          \r\n          if (data.status === 'completed') {\r\n            setIsProcessing(false);\r\n            setProcessingComplete(true);\r\n            setActiveTab('results'); // Auto-navigate to results tab when completed\r\n            eventSource.close();\r\n            fetchStatus();\r\n          } else if (data.status === 'error') {\r\n            setIsProcessing(false);\r\n            eventSource.close();\r\n            setError('Processing failed: ' + data.log_messages?.slice(-1)[0]);\r\n          }\r\n        };\r\n        \r\n        eventSource.onerror = () => {\r\n          setIsProcessing(false);\r\n          eventSource.close();\r\n          setError('Connection to progress stream lost');\r\n        };\r\n      } else {\r\n        setIsProcessing(false);\r\n        setError('Failed to start processing');\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to start processing:', error);\r\n      setIsProcessing(false);\r\n      setError('Failed to start processing');\r\n    }\r\n  };\r\n\r\n  const handleStopProcessing = async () => {\r\n    try {\r\n      const headers: any = {};\r\n      const token = localStorage.getItem('access_token') || sessionStorage.getItem('access_token');\r\n      if (token) headers['Authorization'] = `Bearer ${token}`;\r\n      \r\n      await fetch('/api/v1/phase4/stop-processing', {\r\n        method: 'POST',\r\n        headers\r\n      });\r\n      \r\n      setIsProcessing(false);\r\n      setProgress(null);\r\n    } catch (error) {\r\n      console.error('Failed to stop processing:', error);\r\n    }\r\n  };\r\n\r\n  const handleExportResults = async () => {\r\n    try {\r\n      const headers: any = {};\r\n      const token = localStorage.getItem('access_token') || sessionStorage.getItem('access_token');\r\n      if (token) headers['Authorization'] = `Bearer ${token}`;\r\n      \r\n      const response = await fetch('/api/v1/phase4/export-results', {\r\n        headers\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const blob = await response.blob();\r\n        const url = window.URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = `phase4_date_processed_results_${new Date().toISOString().split('T')[0]}.xlsx`;\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        window.URL.revokeObjectURL(url);\r\n        document.body.removeChild(a);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to export results:', error);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center h-64\">\r\n        <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n        <div className=\"flex\">\r\n          <div className=\"flex-shrink-0\">\r\n            <Database className=\"h-5 w-5 text-red-400\" />\r\n          </div>\r\n          <div className=\"ml-3\">\r\n            <h3 className=\"text-sm font-medium text-red-800\">Error</h3>\r\n            <p className=\"mt-1 text-sm text-red-700\">{error}</p>\r\n            <button \r\n              onClick={() => {\r\n                setError(null);\r\n                fetchStatus();\r\n              }}\r\n              className=\"mt-2 text-sm text-red-600 hover:text-red-500 underline\"\r\n            >\r\n              Try again\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"bg-white shadow rounded-lg p-6\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h2 className=\"text-2xl font-bold text-gray-900 flex items-center\">\r\n              <Database className=\"h-8 w-8 text-blue-600 mr-3\" />\r\n              Phase 4: Enhanced Date Processing\r\n            </h2>\r\n            <p className=\"text-gray-600 mt-1\">\r\n              Consolidate date fields and extract missing dates using AI assistance\r\n            </p>\r\n          </div>\r\n          <div className=\"flex items-center space-x-4\">\r\n            {status?.database_info && (\r\n              <div className=\"text-right\">\r\n                <p className=\"text-sm text-gray-500\">Target Database</p>\r\n                <p className=\"font-medium\">Date-Enriched-Batches</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Success Notification */}\r\n      {successMessage && (\r\n        <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\r\n          <div className=\"flex\">\r\n            <div className=\"flex-shrink-0\">\r\n              <CheckCircle className=\"h-5 w-5 text-green-400\" />\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className=\"text-sm text-green-700\">{successMessage}</p>\r\n            </div>\r\n            <div className=\"ml-auto pl-3\">\r\n              <button\r\n                onClick={() => setSuccessMessage(null)}\r\n                className=\"inline-flex text-green-400 hover:text-green-500\"\r\n              >\r\n                <span className=\"sr-only\">Dismiss</span>\r\n                Ã—\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Tab Navigation */}\r\n      <div className=\"bg-white shadow rounded-lg\">\r\n        <div className=\"border-b border-gray-200\">\r\n          <nav className=\"-mb-px flex space-x-8\" aria-label=\"Tabs\">\r\n            <button\r\n              onClick={() => setActiveTab('configuration')}\r\n              className={`whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm ${\r\n                activeTab === 'configuration'\r\n                  ? 'border-blue-500 text-blue-600'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n              }`}\r\n            >\r\n              <Settings className=\"h-5 w-5 inline mr-2\" />\r\n              Configuration\r\n            </button>\r\n            <button\r\n              onClick={async () => {\r\n                setActiveTab('merge');\r\n                // fetch metadata list\r\n                try {\r\n                  const res = await fetch('/api/v1/phase4/metadata');\r\n                  const data = await res.json();\r\n                  if (data.success) {\r\n                    setMetadataFiles(data.files || []);\r\n                    setMetadataDbEntries(data.db_entries || []);\r\n                  }\r\n                } catch (e) {\r\n                  console.error('Failed to fetch metadata', e);\r\n                }\r\n              }}\r\n              className={`whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm ${\r\n                activeTab === 'merge'\r\n                  ? 'border-green-500 text-green-600 bg-green-50'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n              }`}\r\n            >\r\n              <FileText className=\"h-5 w-5 inline mr-2\" />\r\n              Date Merge\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('search')}\r\n              className={`whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm ${\r\n                activeTab === 'search'\r\n                  ? 'border-purple-500 text-purple-600 bg-purple-50'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n              }`}\r\n            >\r\n              <Search className=\"h-5 w-5 inline mr-2\" />\r\n              Date Search\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('processing')}\r\n              className={`whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm ${\r\n                activeTab === 'processing'\r\n                  ? 'border-blue-500 text-blue-600'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n              }`}\r\n            >\r\n              <Activity className=\"h-5 w-5 inline mr-2\" />\r\n              Processing\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('results')}\r\n              className={`whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm ${\r\n                activeTab === 'results'\r\n                  ? 'border-blue-500 text-blue-600'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n              }`}\r\n            >\r\n              <BarChart3 className=\"h-5 w-5 inline mr-2\" />\r\n              Results & Export\r\n            </button>\r\n          </nav>\r\n        </div>\r\n\r\n        {/* Tab Content */}\r\n        <div className=\"p-6\">\r\n          {activeTab === 'configuration' && (\r\n            <div className=\"space-y-6\">\r\n              <h3 className=\"text-lg font-semibold mb-4 flex items-center\">\r\n                <Settings className=\"h-5 w-5 text-gray-600 mr-2\" />\r\n                Configuration\r\n              </h3>\r\n\r\n              <div className=\"space-y-4\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                  {/* Mongo URI removed - backend-managed */}\r\n\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">Source Database</label>\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <input type=\"text\" value={sourceDb} onChange={(e) => setSourceDb(e.target.value)} className=\"w-full px-3 py-2 border border-gray-300 rounded-md\" />\r\n                      <button onClick={handleTestConnection} className=\"px-3 py-2 bg-blue-600 text-white rounded-md\">Test</button>\r\n                      <button onClick={handleTestGpt} className=\"px-3 py-2 bg-indigo-600 text-white rounded-md\">Test GPT</button>\r\n                    </div>\r\n                    <p className=\"text-xs text-gray-500 mt-1\">Click Test to verify backend connection to the configured backend MongoDB (backend config is used).</p>\r\n                    {testConnStatus !== 'idle' && (\r\n                      <div className={`mt-2 text-sm ${testConnStatus === 'success' ? 'text-green-700' : 'text-red-700'}`}>{testConnMessage}</div>\r\n                    )}\r\n                    {testGptStatus !== 'idle' && (\r\n                      <div className={`mt-2 text-sm ${testGptStatus === 'success' ? 'text-green-700' : 'text-red-700'}`}>{testGptMessage}</div>\r\n                    )}\r\n                  </div>\r\n                  {/* Source Collection removed: use batch selector instead */}\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">Target Database</label>\r\n                    <input type=\"text\" value={targetDb} onChange={(e) => setTargetDb(e.target.value)} className=\"w-full px-3 py-2 border border-gray-300 rounded-md\" />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                  {/* Processing Mode Selection */}\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-3\">Processing Mode</label>\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"flex items-center\">\r\n                        <input type=\"radio\" value=\"all\" checked={processingMode === 'all'} onChange={(e) => setProcessingMode(e.target.value as 'single' | 'all')} className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300\" />\r\n                        <span className=\"ml-2 text-sm text-gray-700\">Process All Batches</span>\r\n                      </label>\r\n                      <label className=\"flex items-center\">\r\n                        <input type=\"radio\" value=\"single\" checked={processingMode === 'single'} onChange={(e) => setProcessingMode(e.target.value as 'single' | 'all')} className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300\" />\r\n                        <span className=\"ml-2 text-sm text-gray-700\">Process Single Batch</span>\r\n                      </label>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Batch Selection (only when single mode) */}\r\n                  {processingMode === 'single' && (\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">Select Batch</label>\r\n                      <select value={selectedBatch} onChange={(e) => setSelectedBatch(e.target.value)} className=\"w-full px-3 py-2 border border-gray-300 rounded-md\">\r\n                        {availableBatches.map((batch) => (\r\n                          <option key={batch} value={batch}>{batch}</option>\r\n                        ))}\r\n                      </select>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Collection Prefix */}\r\n                  <div className=\"md:col-span-2\">\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">Target Collection Prefix</label>\r\n                    <input type=\"text\" value={collectionPrefix} onChange={(e) => setCollectionPrefix(e.target.value)} placeholder=\"e.g., batch, filled, processed\" className=\"w-full px-3 py-2 border border-gray-300 rounded-md\" />\r\n                    <p className=\"text-xs text-gray-500 mt-1\">Output collections will be named: {collectionPrefix}_1, {collectionPrefix}_2, etc.</p>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">Batch Size</label>\r\n                    <input type=\"number\" value={batchSize} onChange={(e) => setBatchSize(Number(e.target.value) || 1)} min={1} className=\"w-full px-3 py-2 border border-gray-300 rounded-md\" />\r\n                    <p className=\"text-xs text-gray-500 mt-1\">Number of documents to process per chunk (performance tuning).</p>\r\n                  </div>\r\n\r\n                  <div className=\"md:col-span-2 border-l pl-4\">\r\n                    <label className=\"flex items-center text-sm font-medium text-gray-700 mb-2\">\r\n                      <input type=\"checkbox\" checked={dryRun} onChange={(e) => setDryRun(e.target.checked)} className=\"mr-2\" />\r\n                      Dry Run (do not write to target DB)\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"mt-3\">\r\n                  <label className=\"flex items-center text-sm font-medium text-gray-700\">\r\n                    <input type=\"checkbox\" checked={generateMetadata} onChange={(e) => setGenerateMetadata(e.target.checked)} className=\"mr-2\" />\r\n                    Generate and save metadata for this run\r\n                  </label>\r\n                  <p className=\"text-xs text-gray-500 mt-1\">When enabled, per-batch and overall metadata will be saved to the server metadata folder and the database.</p>\r\n                </div>\r\n\r\n                {/* Azure OpenAI config is backend-managed; UI fields removed */}\r\n\r\n                {/* Available Batches Info */}\r\n                {availableBatches.length > 0 && (\r\n                  <div className=\"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\r\n                    <div className=\"flex items-center mb-2\">\r\n                      <Database className=\"h-4 w-4 text-blue-600 mr-2\" />\r\n                      <span className=\"text-sm font-medium text-blue-800\">Available Source Batches</span>\r\n                    </div>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                      {availableBatches.map((batch) => (\r\n                        <span key={batch} className=\"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-md font-mono\">\r\n                          {batch}\r\n                        </span>\r\n                      ))}\r\n                    </div>\r\n                    <p className=\"text-xs text-blue-600 mt-2\">\r\n                      Total: {availableBatches.length} batch{availableBatches.length !== 1 ? 'es' : ''} ready for processing\r\n                    </p>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Configuration Summary & Next Steps */}\r\n                <div className=\"mt-6 p-4 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg\">\r\n                  <div className=\"flex items-start justify-between\">\r\n                    <div>\r\n                      <h4 className=\"text-sm font-semibold text-green-800 mb-2\">Configuration Complete</h4>\r\n                      <div className=\"text-sm text-green-700 space-y-1\">\r\n                        <p>â€¢ Processing mode: <span className=\"font-medium capitalize\">{processingMode}</span></p>\r\n                        {processingMode === 'single' && selectedBatch && (\r\n                          <p>â€¢ Selected batch: <span className=\"font-medium font-mono\">{selectedBatch}</span></p>\r\n                        )}\r\n                        <p>â€¢ Target collection prefix: <span className=\"font-medium font-mono\">{collectionPrefix}</span></p>\r\n                        <p>â€¢ Chunk size: <span className=\"font-medium\">{batchSize}</span> documents per batch</p>\r\n                        {dryRun && <p>â€¢ <span className=\"font-medium text-orange-600\">Dry run mode enabled</span> (no data will be written)</p>}\r\n                      </div>\r\n                    </div>\r\n                    <button \r\n                      onClick={() => setActiveTab('merge')} \r\n                      className=\"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium shadow-sm\"\r\n                    >\r\n                      <FileText className=\"h-4 w-4 mr-2\" />\r\n                      Start Date Merge\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Action Buttons */}\r\n                <div className=\"flex justify-between items-center pt-4 border-t border-gray-200\">\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <button \r\n                      onClick={handleSaveConfig} \r\n                      className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm font-medium\"\r\n                    >\r\n                      Save Configuration\r\n                    </button>\r\n                    <button \r\n                      onClick={handleResetConfig} \r\n                      className=\"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors text-sm border border-gray-300\"\r\n                    >\r\n                      Reset to Defaults\r\n                    </button>\r\n                  </div>\r\n                  \r\n                  <div className=\"text-xs text-gray-500\">\r\n                    Configuration saved automatically\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {activeTab === 'processing' && (\r\n            <div className=\"space-y-6\">\r\n              <h3 className=\"text-lg font-semibold mb-4 flex items-center\">\r\n                <Activity className=\"h-5 w-5 text-gray-600 mr-2\" />\r\n                Processing Control\r\n              </h3>\r\n              \r\n              <div className=\"flex items-center space-x-4\">\r\n                {!isProcessing ? (\r\n                  <button\r\n                    onClick={handleStartProcessing}\r\n                    disabled={processingMode === 'single' && !selectedBatch}\r\n                    className=\"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed\"\r\n                  >\r\n                    <Play className=\"h-4 w-4 mr-2\" />\r\n                    Start Processing\r\n                  </button>\r\n                ) : (\r\n                  <button\r\n                    onClick={handleStopProcessing}\r\n                    className=\"flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700\"\r\n                  >\r\n                    <Square className=\"h-4 w-4 mr-2\" />\r\n                    Stop Processing\r\n                  </button>\r\n                )}\r\n\r\n                <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\r\n                  {isProcessing ? (\r\n                    <>\r\n                      <Clock className=\"h-4 w-4 text-orange-500\" />\r\n                      <span>Processing...</span>\r\n                    </>\r\n                  ) : processingComplete ? (\r\n                    <>\r\n                      <CheckCircle className=\"h-4 w-4 text-green-500\" />\r\n                      <span>Completed</span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <Activity className=\"h-4 w-4 text-gray-400\" />\r\n                      <span>Ready</span>\r\n                    </>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Progress Visualization */}\r\n              {(isProcessing || progress) && (\r\n                <div className=\"space-y-4\">\r\n                  {progress && (\r\n                    <div className=\"space-y-4\">\r\n                      {/* Overall Progress */}\r\n                      <div>\r\n                        <div className=\"flex justify-between items-center mb-2\">\r\n                          <span className=\"text-sm font-medium text-gray-700\">Overall Progress</span>\r\n                          <span className=\"text-sm text-gray-600\">\r\n                            {progress.documents_processed}/{progress.total_documents} documents\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                          <div\r\n                            className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\r\n                            style={{ width: `${progress.overall_progress}%` }}\r\n                          ></div>\r\n                        </div>\r\n                        <div className=\"text-right text-xs text-gray-500 mt-1\">\r\n                          {progress.overall_progress.toFixed(1)}%\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Current Batch Progress */}\r\n                      {progress.current_batch && (\r\n                        <div>\r\n                          <div className=\"flex justify-between items-center mb-2\">\r\n                            <span className=\"text-sm font-medium text-gray-700\">\r\n                              Current Batch: {progress.current_batch}\r\n                            </span>\r\n                            <span className=\"text-sm text-gray-600\">\r\n                              {progress.current_batch_progress.toFixed(1)}%\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                            <div\r\n                              className=\"bg-green-500 h-2 rounded-full transition-all duration-300\"\r\n                              style={{ width: `${progress.current_batch_progress}%` }}\r\n                            ></div>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n\r\n                      {/* Current Document */}\r\n                      {progress.current_document && (\r\n                        <div className=\"bg-gray-50 rounded-lg p-3\">\r\n                          <div className=\"flex items-center\">\r\n                            <FileText className=\"h-4 w-4 text-gray-500 mr-2\" />\r\n                            <span className=\"text-sm font-medium\">Processing:</span>\r\n                            <span className=\"text-sm text-gray-700 ml-2 truncate\">\r\n                              {progress.current_document}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n\r\n                      {/* Batch Summary */}\r\n                      {progress.batch_summary && (\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4\">\r\n                          <div className=\"bg-green-50 p-3 rounded-lg\">\r\n                            <div className=\"text-sm font-medium text-green-800\">Completed</div>\r\n                            <div className=\"text-lg font-bold text-green-900\">\r\n                              {progress.batch_summary.completed_batches.length}\r\n                            </div>\r\n                            <div className=\"text-xs text-green-600\">\r\n                              {progress.batch_summary.completed_batches.slice(-3).join(', ')}\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"bg-blue-50 p-3 rounded-lg\">\r\n                            <div className=\"text-sm font-medium text-blue-800\">Current</div>\r\n                            <div className=\"text-lg font-bold text-blue-900\">\r\n                              {progress.batch_summary.current_batch || 'None'}\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"bg-gray-50 p-3 rounded-lg\">\r\n                            <div className=\"text-sm font-medium text-gray-800\">Remaining</div>\r\n                            <div className=\"text-lg font-bold text-gray-900\">\r\n                              {progress.batch_summary.remaining_batches.length}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Live Log */}\r\n              {progress?.log_messages && progress.log_messages.length > 0 && (\r\n                <div>\r\n                  <h4 className=\"text-md font-semibold mb-3 flex items-center\">\r\n                    <Zap className=\"h-4 w-4 text-gray-600 mr-2\" />\r\n                    Live Processing Log\r\n                  </h4>\r\n                  \r\n                  <div className=\"bg-gray-900 text-green-400 font-mono text-sm p-4 rounded-lg max-h-64 overflow-y-auto\">\r\n                    {progress.log_messages.slice(-20).map((message, index) => (\r\n                      <div key={index} className=\"mb-1\">\r\n                        {message}\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Navigation */}\r\n              <div className=\"flex justify-between\">\r\n                <button\r\n                  onClick={() => setActiveTab('configuration')}\r\n                  className=\"flex items-center px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50\"\r\n                >\r\n                  Back to Configuration\r\n                </button>\r\n                {processingComplete && (\r\n                  <button\r\n                    onClick={() => setActiveTab('results')}\r\n                    className=\"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700\"\r\n                  >\r\n                    View Results\r\n                    <BarChart3 className=\"h-4 w-4 ml-2\" />\r\n                  </button>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n          {activeTab === 'merge' && (\r\n            <div className=\"space-y-6\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <h3 className=\"text-lg font-semibold flex items-center\">\r\n                  <FileText className=\"h-5 w-5 text-gray-600 mr-2\" />\r\n                  Date Field Merge Processing\r\n                </h3>\r\n                <div className=\"flex items-center space-x-2 text-sm\">\r\n                  {isProcessing ? (\r\n                    <div className=\"flex items-center text-orange-600\">\r\n                      <Clock className=\"h-4 w-4 mr-1 animate-pulse\" />\r\n                      Processing...\r\n                    </div>\r\n                  ) : processingComplete ? (\r\n                    <div className=\"flex items-center text-green-600\">\r\n                      <CheckCircle className=\"h-4 w-4 mr-1\" />\r\n                      Completed\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"flex items-center text-gray-500\">\r\n                      <Activity className=\"h-4 w-4 mr-1\" />\r\n                      Ready to Merge\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Processing Controls */}\r\n              <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                  <div>\r\n                    <h4 className=\"text-lg font-semibold text-blue-900\">Date Field Merge</h4>\r\n                    <p className=\"text-blue-700 text-sm mt-1\">\r\n                      Consolidate Date and Promulgation_Date fields into a single Date field\r\n                    </p>\r\n                  </div>\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    {!isProcessing ? (\r\n                      <button\r\n                        onClick={async () => {\r\n                          // Enhanced merge processing\r\n                          const requestBody = {\r\n                            processing_mode: processingMode,\r\n                            selected_batch: processingMode === 'single' ? selectedBatch : null,\r\n                            collection_prefix: collectionPrefix,\r\n                            batch_size: batchSize,\r\n                            dry_run: dryRun,\r\n                            generate_metadata: generateMetadata\r\n                          };\r\n\r\n                          try {\r\n                            setIsProcessing(true);\r\n                            setProcessingComplete(false);\r\n                            setProgress(null);\r\n\r\n                            const res = await fetch('/api/v1/phase4/start-processing', { \r\n                              method: 'POST', \r\n                              headers: { 'Content-Type': 'application/json' }, \r\n                              body: JSON.stringify(requestBody) \r\n                            });\r\n                            \r\n                            if (res.ok) {\r\n                              // Start listening for progress updates\r\n                              const eventSource = new EventSource('/api/v1/phase4/processing-progress');\r\n                              eventSource.onmessage = (event) => {\r\n                                const data: ProcessingProgress = JSON.parse(event.data);\r\n                                setProgress(data);\r\n                                \r\n                                if (data.status === 'completed') {\r\n                                  setIsProcessing(false);\r\n                                  setProcessingComplete(true);\r\n                                  eventSource.close();\r\n                                  // Refresh metadata and status\r\n                                  fetchMetadata();\r\n                                  fetchStatus();\r\n                                }\r\n                              };\r\n                              \r\n                              eventSource.onerror = () => {\r\n                                setIsProcessing(false);\r\n                                eventSource.close();\r\n                              };\r\n                            } else {\r\n                              setIsProcessing(false);\r\n                              alert('Failed to start merge processing');\r\n                            }\r\n                          } catch (e) {\r\n                            setIsProcessing(false);\r\n                            console.error(e);\r\n                            alert('Failed to start merge processing');\r\n                          }\r\n                        }}\r\n                        disabled={(processingMode === 'single' && !selectedBatch) || isProcessing}\r\n                        className=\"flex items-center px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-700 hover:to-green-800 disabled:bg-gray-400 disabled:cursor-not-allowed font-medium shadow-lg\"\r\n                      >\r\n                        <Play className=\"h-5 w-5 mr-2\" />\r\n                        Start Date Merge\r\n                      </button>\r\n                    ) : (\r\n                      <button\r\n                        onClick={handleStopProcessing}\r\n                        className=\"flex items-center px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-lg hover:from-red-700 hover:to-red-800 font-medium shadow-lg\"\r\n                      >\r\n                        <Square className=\"h-5 w-5 mr-2\" />\r\n                        Stop Processing\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Processing Configuration Display */}\r\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\r\n                  <div className=\"bg-white/70 rounded-lg p-3\">\r\n                    <div className=\"text-gray-600 font-medium\">Mode</div>\r\n                    <div className=\"text-blue-900 font-semibold capitalize\">{processingMode}</div>\r\n                  </div>\r\n                  <div className=\"bg-white/70 rounded-lg p-3\">\r\n                    <div className=\"text-gray-600 font-medium\">Batch</div>\r\n                    <div className=\"text-blue-900 font-semibold\">\r\n                      {processingMode === 'single' ? selectedBatch || 'None' : 'All Batches'}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"bg-white/70 rounded-lg p-3\">\r\n                    <div className=\"text-gray-600 font-medium\">Chunk Size</div>\r\n                    <div className=\"text-blue-900 font-semibold\">{batchSize}</div>\r\n                  </div>\r\n                  <div className=\"bg-white/70 rounded-lg p-3\">\r\n                    <div className=\"text-gray-600 font-medium\">Dry Run</div>\r\n                    <div className=\"text-blue-900 font-semibold\">{dryRun ? 'Yes' : 'No'}</div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Real-time Progress Display */}\r\n              {(isProcessing || progress) && (\r\n                <div className=\"bg-white border border-gray-200 rounded-xl p-6 shadow-sm\">\r\n                  <h4 className=\"text-lg font-semibold mb-4 flex items-center\">\r\n                    <Activity className=\"h-5 w-5 text-blue-600 mr-2\" />\r\n                    Processing Progress\r\n                  </h4>\r\n                  \r\n                  {progress && (\r\n                    <div className=\"space-y-6\">\r\n                      {/* Overall Progress */}\r\n                      <div>\r\n                        <div className=\"flex justify-between items-center mb-3\">\r\n                          <span className=\"text-sm font-medium text-gray-700\">Overall Progress</span>\r\n                          <span className=\"text-sm font-semibold text-gray-900\">\r\n                            {progress.documents_processed?.toLocaleString()}/{progress.total_documents?.toLocaleString()} documents\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"relative w-full bg-gray-200 rounded-full h-3\">\r\n                          <div\r\n                            className=\"absolute left-0 top-0 bg-gradient-to-r from-blue-500 to-blue-600 h-3 rounded-full transition-all duration-500 flex items-center justify-end pr-2\"\r\n                            style={{ width: `${Math.max(progress.overall_progress, 0)}%` }}\r\n                          >\r\n                            <span className=\"text-white text-xs font-bold\">\r\n                              {progress.overall_progress?.toFixed(1)}%\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Current Batch Progress */}\r\n                      {progress.current_batch && (\r\n                        <div>\r\n                          <div className=\"flex justify-between items-center mb-3\">\r\n                            <span className=\"text-sm font-medium text-gray-700\">\r\n                              Current Batch: <span className=\"font-semibold text-gray-900\">{progress.current_batch}</span>\r\n                            </span>\r\n                            <span className=\"text-sm font-semibold text-gray-900\">\r\n                              {progress.current_batch_progress?.toFixed(1)}%\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"relative w-full bg-gray-200 rounded-full h-2\">\r\n                            <div\r\n                              className=\"absolute left-0 top-0 bg-gradient-to-r from-green-500 to-green-600 h-2 rounded-full transition-all duration-500\"\r\n                              style={{ width: `${Math.max(progress.current_batch_progress || 0, 0)}%` }}\r\n                            ></div>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n\r\n                      {/* Current Document Being Processed */}\r\n                      {progress.current_document && (\r\n                        <div className=\"bg-gradient-to-r from-gray-50 to-blue-50 rounded-lg p-4 border-l-4 border-blue-500\">\r\n                          <div className=\"flex items-start\">\r\n                            <FileText className=\"h-5 w-5 text-blue-600 mr-3 mt-0.5 flex-shrink-0\" />\r\n                            <div>\r\n                              <div className=\"text-sm font-medium text-gray-700 mb-1\">Currently Processing:</div>\r\n                              <div className=\"text-sm text-gray-900 font-mono bg-white px-2 py-1 rounded border\">\r\n                                {progress.current_document}\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n\r\n                      {/* Processing Statistics */}\r\n                      {progress.batch_summary && (\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                          <div className=\"bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200 p-4 rounded-lg\">\r\n                            <div className=\"flex items-center mb-2\">\r\n                              <CheckCircle className=\"h-5 w-5 text-green-600 mr-2\" />\r\n                              <div className=\"text-sm font-medium text-green-800\">Completed Batches</div>\r\n                            </div>\r\n                            <div className=\"text-2xl font-bold text-green-900\">\r\n                              {progress.batch_summary.completed_batches?.length || 0}\r\n                            </div>\r\n                            {progress.batch_summary.completed_batches?.length > 0 && (\r\n                              <div className=\"text-xs text-green-600 mt-1 truncate\">\r\n                                Latest: {progress.batch_summary.completed_batches.slice(-1)[0]}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                          <div className=\"bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 p-4 rounded-lg\">\r\n                            <div className=\"flex items-center mb-2\">\r\n                              <Activity className=\"h-5 w-5 text-blue-600 mr-2\" />\r\n                              <div className=\"text-sm font-medium text-blue-800\">Current Batch</div>\r\n                            </div>\r\n                            <div className=\"text-lg font-bold text-blue-900\">\r\n                              {progress.batch_summary.current_batch || 'None'}\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"bg-gradient-to-br from-gray-50 to-slate-50 border border-gray-200 p-4 rounded-lg\">\r\n                            <div className=\"flex items-center mb-2\">\r\n                              <Clock className=\"h-5 w-5 text-gray-600 mr-2\" />\r\n                              <div className=\"text-sm font-medium text-gray-800\">Remaining Batches</div>\r\n                            </div>\r\n                            <div className=\"text-2xl font-bold text-gray-900\">\r\n                              {progress.batch_summary.remaining_batches?.length || 0}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n\r\n                      {/* Live Processing Log */}\r\n                      {progress?.log_messages && progress.log_messages.length > 0 && (\r\n                        <div>\r\n                          <h5 className=\"text-md font-semibold mb-3 flex items-center\">\r\n                            <Zap className=\"h-4 w-4 text-yellow-600 mr-2\" />\r\n                            Live Processing Log\r\n                          </h5>\r\n                          \r\n                          <div className=\"bg-gray-900 text-green-400 font-mono text-sm p-4 rounded-lg max-h-48 overflow-y-auto border\">\r\n                            {progress.log_messages.slice(-15).map((message, index) => (\r\n                              <div key={index} className=\"mb-1 leading-relaxed\">\r\n                                <span className=\"text-green-500\">[{new Date().toLocaleTimeString()}]</span> {message}\r\n                              </div>\r\n                            ))}\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Metadata and Results Section */}\r\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                <div className=\"bg-white border border-gray-200 rounded-xl p-6 shadow-sm\">\r\n                  <div className=\"flex items-center justify-between mb-4\">\r\n                    <h4 className=\"text-md font-semibold text-gray-900\">Metadata Files</h4>\r\n                    <button\r\n                      onClick={async () => {\r\n                        try {\r\n                          await fetchMetadata();\r\n                        } catch (e) {\r\n                          console.error('Refresh failed:', e);\r\n                        }\r\n                      }}\r\n                      disabled={loading}\r\n                      className=\"flex items-center px-3 py-1.5 text-sm bg-blue-50 text-blue-600 hover:bg-blue-100 hover:text-blue-700 disabled:bg-gray-50 disabled:text-gray-400 rounded-md transition-colors border border-blue-200\"\r\n                    >\r\n                      {loading ? (\r\n                        <div className=\"animate-spin h-3 w-3 border-2 border-blue-600 border-t-transparent rounded-full mr-1\"></div>\r\n                      ) : (\r\n                        <Activity className=\"h-3 w-3 mr-1\" />\r\n                      )}\r\n                      {loading ? 'Refreshing...' : 'Refresh'}\r\n                    </button>\r\n                  </div>\r\n                  <div className=\"max-h-64 overflow-y-auto\">\r\n                    {metadataFiles.length === 0 ? (\r\n                      <div className=\"text-sm text-gray-500 py-8 text-center\">\r\n                        No metadata files found.<br />\r\n                        <span className=\"text-xs\">Run processing to generate metadata</span>\r\n                      </div>\r\n                    ) : (\r\n                      metadataFiles.map((f) => (\r\n                        <div \r\n                          key={f.filename} \r\n                          className={`p-3 rounded-lg hover:bg-gray-50 cursor-pointer border mb-2 transition-colors ${\r\n                            selectedMetadata?.filename === f.filename \r\n                              ? 'bg-blue-50 border-blue-200' \r\n                              : 'border-gray-200'\r\n                          }`} \r\n                          onClick={() => setSelectedMetadata(f)}\r\n                        >\r\n                          <div className=\"flex justify-between items-start\">\r\n                            <div className=\"flex-1\">\r\n                              <div className=\"text-sm font-medium text-gray-900 mb-1\">{f.filename}</div>\r\n                              <div className=\"text-xs text-gray-500\">\r\n                                Modified: {new Date(f.modified * 1000).toLocaleString()}\r\n                              </div>\r\n                            </div>\r\n                            <div className=\"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded\">\r\n                              {(f.size/1024).toFixed(1)} KB\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      ))\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"bg-white border border-gray-200 rounded-xl p-6 shadow-sm\">\r\n                  <div className=\"flex items-center justify-between mb-4\">\r\n                    <h4 className=\"text-md font-semibold text-gray-900\">Database Results</h4>\r\n                    <button\r\n                      onClick={async () => {\r\n                        try {\r\n                          await fetchStatus();\r\n                        } catch (e) {\r\n                          console.error('Refresh failed:', e);\r\n                        }\r\n                      }}\r\n                      disabled={loading}\r\n                      className=\"flex items-center px-3 py-1.5 text-sm bg-green-50 text-green-600 hover:bg-green-100 hover:text-green-700 disabled:bg-gray-50 disabled:text-gray-400 rounded-md transition-colors border border-green-200\"\r\n                    >\r\n                      {loading ? (\r\n                        <div className=\"animate-spin h-3 w-3 border-2 border-green-600 border-t-transparent rounded-full mr-1\"></div>\r\n                      ) : (\r\n                        <Database className=\"h-3 w-3 mr-1\" />\r\n                      )}\r\n                      {loading ? 'Refreshing...' : 'Refresh'}\r\n                    </button>\r\n                  </div>\r\n                  <div className=\"max-h-64 overflow-y-auto\">\r\n                    {metadataDbEntries.length === 0 ? (\r\n                      <div className=\"text-sm text-gray-500 py-8 text-center\">\r\n                        No database entries found.<br />\r\n                        <span className=\"text-xs\">Run processing to create target collections</span>\r\n                      </div>\r\n                    ) : (\r\n                      metadataDbEntries.map((d) => (\r\n                        <div key={d._id} className=\"p-3 rounded-lg hover:bg-gray-50 border border-gray-200 mb-2\">\r\n                          <div className=\"flex justify-between items-start\">\r\n                            <div>\r\n                              <div className=\"text-sm font-medium text-gray-900\">{d.batch}</div>\r\n                              <div className=\"text-xs text-gray-500\">Target: {d.target_collection}</div>\r\n                            </div>\r\n                            <div className=\"text-right\">\r\n                              <div className=\"text-sm font-semibold text-green-600\">\r\n                                {d.processed?.toLocaleString()}\r\n                              </div>\r\n                              <div className=\"text-xs text-gray-500\">\r\n                                / {d.total_documents?.toLocaleString()}\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      ))\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Action Buttons */}\r\n              <div className=\"flex items-center justify-between pt-4 border-t border-gray-200\">\r\n                <button\r\n                  onClick={async () => {\r\n                    if (!selectedMetadata) {\r\n                      alert('Please select a metadata file first');\r\n                      return;\r\n                    }\r\n                    try {\r\n                      const res = await fetch('/api/v1/phase4/metadata');\r\n                      const data = await res.json();\r\n                      const fileInfo = data.files.find((x: any) => x.filename === selectedMetadata.filename);\r\n                      if (!fileInfo) return;\r\n                      \r\n                      const fileRes = await fetch('/api/v1/phase4/metadata?batch=' + encodeURIComponent(selectedMetadata.filename));\r\n                      const fileJson = await fileRes.json();\r\n                      \r\n                      const blob = new Blob([JSON.stringify(fileJson, null, 2)], { type: 'application/json' });\r\n                      const url = window.URL.createObjectURL(blob);\r\n                      const a = document.createElement('a');\r\n                      a.href = url;\r\n                      a.download = selectedMetadata.filename;\r\n                      document.body.appendChild(a);\r\n                      a.click();\r\n                      window.URL.revokeObjectURL(url);\r\n                      document.body.removeChild(a);\r\n                    } catch (e) {\r\n                      console.error('Failed to download metadata', e);\r\n                      alert('Failed to download metadata file');\r\n                    }\r\n                  }}\r\n                  disabled={!selectedMetadata}\r\n                  className=\"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed\"\r\n                >\r\n                  <Download className=\"h-4 w-4 mr-2\" />\r\n                  Download Metadata\r\n                </button>\r\n\r\n                {processingComplete && (\r\n                  <button\r\n                    onClick={() => setActiveTab('results')}\r\n                    className=\"flex items-center px-6 py-2 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-700 hover:to-green-800 font-medium\"\r\n                  >\r\n                    <BarChart3 className=\"h-4 w-4 mr-2\" />\r\n                    View Results & Export\r\n                  </button>\r\n                )}\r\n              </div>\r\n\r\n              {/* Selected Metadata Preview */}\r\n              {selectedMetadata && (\r\n                <div className=\"bg-gray-50 border border-gray-200 rounded-xl p-4\">\r\n                  <div className=\"flex items-center mb-3\">\r\n                    <FileText className=\"h-4 w-4 text-gray-600 mr-2\" />\r\n                    <span className=\"text-sm font-medium text-gray-900\">Preview: {selectedMetadata.filename}</span>\r\n                  </div>\r\n                  <pre className=\"text-xs font-mono bg-white border rounded-lg p-3 max-h-32 overflow-y-auto\">\r\n                    {JSON.stringify(metadataDbEntries.find(d => d.batch && selectedMetadata.filename.includes(d.batch)) || {}, null, 2)}\r\n                  </pre>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n          {activeTab === 'results' && (\r\n            <div className=\"space-y-6\">\r\n              <h3 className=\"text-lg font-semibold mb-4 flex items-center\">\r\n                <BarChart3 className=\"h-5 w-5 text-gray-600 mr-2\" />\r\n                Results & Export\r\n              </h3>\r\n\r\n              {/* Export Controls */}\r\n              <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <h4 className=\"text-lg font-semibold text-green-800\">Processing Complete!</h4>\r\n                    <p className=\"text-green-700 mt-1\">\r\n                      Your date enrichment processing has finished successfully. You can now export the results.\r\n                    </p>\r\n                  </div>\r\n                  <button\r\n                    onClick={handleExportResults}\r\n                    className=\"flex items-center px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold\"\r\n                  >\r\n                    <Download className=\"h-5 w-5 mr-2\" />\r\n                    Export to Excel\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Status Summary */}\r\n              {status && (\r\n                <div>\r\n                  <h4 className=\"text-md font-semibold mb-3\">Processing Summary</h4>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <div className=\"bg-blue-50 p-4 rounded-lg\">\r\n                      <div className=\"text-sm font-medium text-blue-800\">Current Phase</div>\r\n                      <div className=\"text-lg font-bold text-blue-900\">{status.current_phase}</div>\r\n                    </div>\r\n                    <div className=\"bg-green-50 p-4 rounded-lg\">\r\n                      <div className=\"text-sm font-medium text-green-800\">Total Documents</div>\r\n                      <div className=\"text-lg font-bold text-green-900\">\r\n                        {status.total_documents?.toLocaleString() || 'N/A'}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"bg-purple-50 p-4 rounded-lg\">\r\n                      <div className=\"text-sm font-medium text-purple-800\">Status</div>\r\n                      <div className=\"text-lg font-bold text-purple-900\">{status.status}</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Final Batch Summary */}\r\n              {progress?.batch_summary && (\r\n                <div>\r\n                  <h4 className=\"text-md font-semibold mb-3\">Batch Processing Results</h4>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <div className=\"bg-green-50 p-4 rounded-lg\">\r\n                      <div className=\"text-sm font-medium text-green-800\">Completed Batches</div>\r\n                      <div className=\"text-lg font-bold text-green-900\">\r\n                        {progress.batch_summary.completed_batches.length}\r\n                      </div>\r\n                      <div className=\"text-xs text-green-600 mt-2\">\r\n                        {progress.batch_summary.completed_batches.join(', ')}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"bg-blue-50 p-4 rounded-lg\">\r\n                      <div className=\"text-sm font-medium text-blue-800\">Documents Processed</div>\r\n                      <div className=\"text-lg font-bold text-blue-900\">\r\n                        {progress.documents_processed.toLocaleString()}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"bg-purple-50 p-4 rounded-lg\">\r\n                      <div className=\"text-sm font-medium text-purple-800\">Success Rate</div>\r\n                      <div className=\"text-lg font-bold text-purple-900\">\r\n                        {progress.overall_progress.toFixed(1)}%\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Navigation */}\r\n              <div className=\"flex justify-between\">\r\n                <button\r\n                  onClick={() => setActiveTab('processing')}\r\n                  className=\"flex items-center px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50\"\r\n                >\r\n                  Back to Processing\r\n                </button>\r\n                <button\r\n                  onClick={() => {\r\n                    setActiveTab('configuration');\r\n                    setProcessingComplete(false);\r\n                    setProgress(null);\r\n                  }}\r\n                  className=\"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\"\r\n                >\r\n                  Start New Processing\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Date Search Tab */}\r\n          {activeTab === 'search' && (\r\n            <DateSearchTab />\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Phase4Dashboard;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}